import{a as x,u as y}from"./DtFpNjUJ.js";import{g as w,j as g,D as k,c as a,a as t,n as m,F as b,v as A,o as r,s as C,p as D,t as p,_ as N}from"./Blq0K2QU.js";const E={class:"fixed inset-0 z-[150] pointer-events-none"},T={class:"absolute top-14 right-4 w-80 glass-card shadow-2xl pointer-events-auto animate-fade-in max-h-[70vh] overflow-hidden flex flex-col"},R={class:"flex-1 overflow-y-auto"},M={key:0,class:"p-8 text-center text-slate-500"},I={key:1,class:"divide-y divide-white/10"},S=["onClick"],$={class:"flex items-start gap-3"},L={class:"flex-1"},V={class:"font-medium text-slate-100 text-sm mb-1"},z={class:"text-sm text-slate-400"},B={class:"text-xs text-slate-500 mt-2"},H={key:0,class:"w-2 h-2 rounded-full bg-primary-500 shrink-0 mt-1"},P=w({__name:"NotificationDropdown",setup(U){const i=x(),n=y(),c=g();console.log("NotificationDropdown mounted, show:",n.show.value),k(()=>n.show.value,e=>{console.log("Show state changed:",e),e&&i.fetchNotifications(!0)},{immediate:!0});const f=async e=>{e.is_read||await i.markAsRead(e.id);const s=e.user_type||n.getUserType?.()||"TEACHER";e.title==="新例外申請通知"||e.type==="EXCEPTION"?s==="ADMIN"&&c.push("/admin/approval"):e.type==="REVIEW_RESULT"||e.title==="例外單審核結果"?s==="TEACHER"&&c.push("/teacher/exceptions"):e.type==="APPROVAL"&&s==="ADMIN"&&c.push("/admin/approval"),n.close()},h=async()=>{await i.markAllAsRead()},v=e=>{const s=new Date(e),l=new Date().getTime()-s.getTime(),d=Math.floor(l/(1e3*60)),u=Math.floor(l/(1e3*60*60)),_=Math.floor(l/(1e3*60*60*24));return d<1?"剛剛":d<60?`${d} 分鐘前`:u<24?`${u} 小時前`:_<7?`${_} 天前`:s.toLocaleDateString("zh-TW",{month:"short",day:"numeric"})};return(e,s)=>(r(),a("div",E,[t("div",{class:"absolute inset-0 bg-black/40 backdrop-blur-sm pointer-events-auto",onClick:s[0]||(s[0]=o=>m(n).close())}),t("div",T,[t("div",{class:"p-4 border-b border-white/10 shrink-0"},[t("div",{class:"flex items-center justify-between"},[s[1]||(s[1]=t("h3",{class:"font-semibold text-slate-100"},"通知",-1)),t("button",{onClick:h,class:"text-sm text-primary-500 hover:text-primary-400 transition-colors"}," 全部標記為已讀 ")])]),t("div",R,[m(i).notifications.length===0?(r(),a("div",M," 無通知 ")):(r(),a("div",I,[(r(!0),a(b,null,A(m(i).notifications,o=>(r(),a("div",{key:o.id,class:C(["p-4 hover:bg-white/5 transition-colors cursor-pointer",{"bg-primary-500/10":!o.is_read}]),onClick:l=>f(o)},[t("div",$,[t("div",L,[t("h4",V,p(o.title),1),t("p",z,p(o.message),1),t("p",B,p(v(o.created_at)),1)]),o.is_read?D("",!0):(r(),a("div",H))])],10,S))),128))]))])])]))}}),O=N(P,[["__scopeId","data-v-db1a0812"]]);export{O as _};
