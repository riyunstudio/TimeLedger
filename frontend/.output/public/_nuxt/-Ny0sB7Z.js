import{g as Q,k as Y,D as z,l as Z,c as l,a as t,p as m,r as d,d as k,t as n,n as o,s as T,y as _,H as U,m as tt,z as P,F as R,v as V,x as et,O as st,q as H,o as i}from"./Blq0K2QU.js";const ot={class:"p-4 md:p-6 max-w-7xl mx-auto"},at={class:"mb-6 md:mb-8"},lt={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},it={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6"},rt={class:"bg-white/5 rounded-xl p-4 border border-white/10"},nt={class:"text-2xl font-bold text-warning-500"},dt={class:"bg-white/5 rounded-xl p-4 border border-white/10"},ct={class:"text-2xl font-bold text-success-500"},ut={class:"bg-white/5 rounded-xl p-4 border border-white/10"},pt={class:"text-2xl font-bold text-critical-500"},xt={class:"bg-white/5 rounded-xl p-4 border border-white/10"},mt={class:"text-2xl font-bold text-slate-400"},bt={class:"mb-6"},ht={class:"flex gap-2 border-b border-white/10 pb-2"},gt={key:0,class:"ml-1 px-1.5 py-0.5 text-xs bg-primary-500/20 text-primary-400 rounded"},vt={key:0},ft={class:"flex flex-wrap gap-3 mb-6"},wt={class:"bg-white/5 rounded-xl border border-white/10 overflow-hidden"},yt={key:0,class:"p-8 text-center"},kt={key:1,class:"p-8 text-center text-slate-400"},_t={key:2,class:"w-full"},Et={class:"divide-y divide-white/5"},Ct={class:"px-4 py-3 text-slate-300"},Tt={class:"px-4 py-3"},$t={class:"px-4 py-3 text-slate-400 text-sm"},Dt={class:"px-4 py-3 text-slate-400 text-sm"},St={key:3,class:"px-4 py-3 bg-white/5 border-t border-white/10 flex items-center justify-between"},Bt={class:"text-slate-400 text-sm"},It={class:"flex gap-2"},Lt=["disabled"],Pt=["disabled"],jt={key:1},Mt={class:"bg-white/5 rounded-xl border border-white/10 overflow-hidden"},Nt={key:0,class:"p-8 text-center"},At={key:1,class:"p-8 text-center text-slate-400"},zt={key:2,class:"w-full"},Ut={class:"divide-y divide-white/5"},Rt={class:"px-4 py-3 text-slate-300"},Vt={class:"px-4 py-3"},Ht={class:"px-2 py-1 rounded-full text-xs font-medium bg-primary-500/20 text-primary-400"},Ft={class:"px-4 py-3 text-slate-400 text-sm"},Gt={class:"px-4 py-3"},qt={class:"flex gap-2"},Ot=["onClick"],Xt=["onClick"],Jt={key:2,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"},Wt={class:"bg-slate-800 rounded-2xl p-6 w-full max-w-md border border-white/10"},Kt={class:"mb-4"},Qt={class:"mb-4"},Yt={class:"mb-6"},Zt={key:0,class:"mb-6 p-4 bg-success-500/10 border border-success-500/30 rounded-xl"},te={class:"flex gap-2"},ee=["value"],se={class:"flex gap-3"},oe=["disabled"],ae={key:0,class:"inline-block w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"},re=Q({__name:"invitations",setup(le){const v=st(),F=Y(),E=H(()=>F.user?.center_id||1),p=d("invitations"),$=d(!0),D=d(!1),S=d([]),b=d([]),f=d({pending:0,accepted:0,declined:0,expired:0}),u=d({status:"",search:""}),r=d({page:1,limit:20,total:0,totalPages:0}),B=d(!1),w=d(!1),h=d(null),c=d({email:"",role:"TEACHER",message:""}),y=d({show:!1,message:"",type:"success"}),x=(a,e="success")=>{y.value={show:!0,message:a,type:e},setTimeout(()=>{y.value.show=!1},3e3)},G=a=>({PENDING:"待處理",ACCEPTED:"已接受",DECLINED:"已婉拒",EXPIRED:"已過期"})[a]||a,q=a=>({TEACHER:"正式老師",SUBSTITUTE:"代課老師"})[a]||a,I=a=>a?new Date(a).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",O=async()=>{try{const a=localStorage.getItem("admin_token"),e=await fetch(`${v.public.apiBase}/admin/centers/${E.value}/invitations/stats`,{headers:{Authorization:`Bearer ${a}`}});if(e.ok){const s=await e.json();f.value={pending:s.datas?.pending||0,accepted:s.datas?.accepted||0,declined:s.datas?.declined||0,expired:s.datas?.expired||0}}}catch(a){console.error("Failed to fetch stats:",a)}},L=async()=>{$.value=!0;try{const a=new URLSearchParams({page:r.value.page.toString(),limit:r.value.limit.toString()});u.value.status&&a.append("status",u.value.status);const e=localStorage.getItem("admin_token"),s=await fetch(`${v.public.apiBase}/admin/centers/${E.value}/invitations?${a}`,{headers:{Authorization:`Bearer ${e}`}});if(s.ok){const g=await s.json();S.value=g.datas?.data||[],r.value.total=g.datas?.total||0,r.value.totalPages=Math.ceil(r.value.total/r.value.limit)}}catch(a){console.error("Failed to fetch invitations:",a)}finally{$.value=!1}},C=async()=>{D.value=!0;try{const a=localStorage.getItem("admin_token"),e=await fetch(`${v.public.apiBase}/admin/centers/${E.value}/invitations/links`,{headers:{Authorization:`Bearer ${a}`}});if(e.ok){const s=await e.json();b.value=s.datas||[]}}catch(a){console.error("Failed to fetch links:",a)}finally{D.value=!1}},j=()=>{r.value.page=1,O(),L(),p.value==="links"&&C()},M=a=>{r.value.page=a,L()},N=H(()=>{if(!u.value.search)return S.value;const a=u.value.search.toLowerCase();return S.value.filter(e=>e.email.toLowerCase().includes(a))}),X=async()=>{if(!(!c.value.email||!c.value.role)){w.value=!0;try{const a=localStorage.getItem("admin_token"),e=await fetch(`${v.public.apiBase}/admin/centers/${E.value}/invitations/generate-link`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify(c.value)}),s=await e.json();if(!e.ok)throw new Error(s.message||"產生邀請連結失敗");h.value=s.datas,C(),x("邀請連結產生成功")}catch(a){x(a.message||"產生邀請連結失敗","error")}finally{w.value=!1}}},J=async a=>{try{await navigator.clipboard.writeText(a.invite_link),x("連結已複製到剪貼簿")}catch{x("複製失敗，請手動複製","error")}},W=async()=>{if(h.value)try{await navigator.clipboard.writeText(h.value.invite_link),x("連結已複製到剪貼簿")}catch{x("複製失敗，請手動複製","error")}},K=async a=>{if(confirm(`確定要撤回「${a.email}」的邀請連結嗎？`))try{const e=localStorage.getItem("admin_token"),s=await fetch(`${v.public.apiBase}/admin/invitations/links/${a.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}}),g=await s.json();if(!s.ok)throw new Error(g.message||"撤回邀請連結失敗");C(),x("邀請連結已撤回")}catch(e){x(e.message||"撤回邀請連結失敗","error")}},A=()=>{B.value=!1,h.value=null,c.value={email:"",role:"TEACHER",message:""}};return z(p,a=>{a==="links"&&b.value.length===0&&C()}),z(u,()=>{r.value.page=1,L()},{deep:!0}),Z(()=>{j()}),(a,e)=>(i(),l("div",ot,[t("div",at,[t("div",lt,[e[11]||(e[11]=t("div",null,[t("h1",{class:"text-2xl md:text-3xl font-bold text-slate-100 mb-2"}," 邀請紀錄 "),t("p",{class:"text-slate-400 text-sm md:text-base"}," 查看邀請老師的歷史記錄與處理結果 ")],-1)),t("button",{onClick:e[0]||(e[0]=s=>B.value=!0),class:"px-4 py-2 bg-primary-500 text-white rounded-xl hover:bg-primary-600 transition-colors flex items-center gap-2"},[...e[10]||(e[10]=[t("svg",{class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})],-1),k(" 產生邀請連結 ",-1)])])])]),t("div",it,[t("div",rt,[e[12]||(e[12]=t("p",{class:"text-slate-400 text-sm"},"待處理",-1)),t("p",nt,n(o(f).pending),1)]),t("div",dt,[e[13]||(e[13]=t("p",{class:"text-slate-400 text-sm"},"已接受",-1)),t("p",ct,n(o(f).accepted),1)]),t("div",ut,[e[14]||(e[14]=t("p",{class:"text-slate-400 text-sm"},"已婉拒",-1)),t("p",pt,n(o(f).declined),1)]),t("div",xt,[e[15]||(e[15]=t("p",{class:"text-slate-400 text-sm"},"已過期",-1)),t("p",mt,n(o(f).expired),1)])]),t("div",bt,[t("div",ht,[t("button",{onClick:e[1]||(e[1]=s=>p.value="invitations"),class:T(["px-4 py-2 rounded-t-lg transition-colors",o(p)==="invitations"?"bg-white/10 text-white":"text-slate-400 hover:text-white"])}," 邀請記錄 ",2),t("button",{onClick:e[2]||(e[2]=s=>p.value="links"),class:T(["px-4 py-2 rounded-t-lg transition-colors",o(p)==="links"?"bg-white/10 text-white":"text-slate-400 hover:text-white"])},[e[16]||(e[16]=k(" 邀請連結 ",-1)),o(b).length>0?(i(),l("span",gt,n(o(b).length),1)):m("",!0)],2)])]),o(p)==="invitations"?(i(),l("div",vt,[t("div",ft,[_(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>o(u).status=s),class:"px-4 py-2 bg-white/5 border border-white/10 rounded-xl text-slate-300 focus:outline-none focus:border-primary-500"},[...e[17]||(e[17]=[tt('<option value="">全部狀態</option><option value="PENDING">待處理</option><option value="ACCEPTED">已接受</option><option value="DECLINED">已婉拒</option><option value="EXPIRED">已過期</option>',5)])],512),[[U,o(u).status]]),_(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>o(u).search=s),type:"text",placeholder:"搜尋 Email...",class:"px-4 py-2 bg-white/5 border border-white/10 rounded-xl text-slate-300 focus:outline-none focus:border-primary-500 flex-1 min-w-[200px]"},null,512),[[P,o(u).search]]),t("button",{onClick:j,class:"px-4 py-2 bg-primary-500/20 border border-primary-500 text-primary-400 rounded-xl hover:bg-primary-500/30 transition-colors"}," 重新整理 ")]),t("div",wt,[o($)?(i(),l("div",yt,[...e[18]||(e[18]=[t("div",{class:"inline-block w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full animate-spin"},null,-1),t("p",{class:"text-slate-400 mt-2"},"載入中...",-1)])])):o(N).length===0?(i(),l("div",kt," 暫無邀請記錄 ")):(i(),l("table",_t,[e[20]||(e[20]=t("thead",{class:"bg-white/5"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-sm font-medium text-slate-400"},"Email"),t("th",{class:"px-4 py-3 text-left text-sm font-medium text-slate-400"},"狀態"),t("th",{class:"px-4 py-3 text-left text-sm font-medium text-slate-400"},"邀請時間"),t("th",{class:"px-4 py-3 text-left text-sm font-medium text-slate-400"},"回應時間"),t("th",{class:"px-4 py-3 text-left text-sm font-medium text-slate-400"},"操作")])],-1)),t("tbody",Et,[(i(!0),l(R,null,V(o(N),s=>(i(),l("tr",{key:s.id,class:"hover:bg-white/5"},[t("td",Ct,n(s.email),1),t("td",Tt,[t("span",{class:T(["px-2 py-1 rounded-full text-xs font-medium",{"bg-warning-500/20 text-warning-500":s.status==="PENDING","bg-success-500/20 text-success-500":s.status==="ACCEPTED","bg-critical-500/20 text-critical-500":s.status==="DECLINED","bg-slate-500/20 text-slate-400":s.status==="EXPIRED"}])},n(G(s.status)),3)]),t("td",$t,n(I(s.created_at)),1),t("td",Dt,n(s.responded_at?I(s.responded_at):"-"),1),e[19]||(e[19]=t("td",{class:"px-4 py-3"},[t("span",{class:"text-slate-500 text-sm"},"-")],-1))]))),128))])])),o(r).totalPages>1?(i(),l("div",St,[t("p",Bt," 第 "+n(o(r).page)+" 頁，共 "+n(o(r).totalPages)+" 頁 ",1),t("div",It,[t("button",{onClick:e[5]||(e[5]=s=>M(o(r).page-1)),disabled:o(r).page===1,class:"px-3 py-1 rounded-lg bg-white/5 text-slate-300 hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed"}," 上一頁 ",8,Lt),t("button",{onClick:e[6]||(e[6]=s=>M(o(r).page+1)),disabled:o(r).page===o(r).totalPages,class:"px-3 py-1 rounded-lg bg-white/5 text-slate-300 hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed"}," 下一頁 ",8,Pt)])])):m("",!0)])])):m("",!0),o(p)==="links"?(i(),l("div",jt,[t("div",Mt,[o(D)?(i(),l("div",Nt,[...e[21]||(e[21]=[t("div",{class:"inline-block w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full animate-spin"},null,-1),t("p",{class:"text-slate-400 mt-2"},"載入中...",-1)])])):o(b).length===0?(i(),l("div",At," 暫無有效邀請連結 ")):(i(),l("table",zt,[e[24]||(e[24]=t("thead",{class:"bg-white/5"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-sm font-medium text-slate-400"},"Email"),t("th",{class:"px-4 py-3 text-left text-sm font-medium text-slate-400"},"職位"),t("th",{class:"px-4 py-3 text-left text-sm font-medium text-slate-400"},"有效期限"),t("th",{class:"px-4 py-3 text-left text-sm font-medium text-slate-400"},"操作")])],-1)),t("tbody",Ut,[(i(!0),l(R,null,V(o(b),s=>(i(),l("tr",{key:s.id,class:"hover:bg-white/5"},[t("td",Rt,n(s.email),1),t("td",Vt,[t("span",Ht,n(q(s.role)),1)]),t("td",Ft,n(I(s.expires_at)),1),t("td",Gt,[t("div",qt,[t("button",{onClick:g=>J(s),class:"text-primary-500 hover:text-primary-400 text-sm flex items-center gap-1"},[...e[22]||(e[22]=[t("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-28 5av-1M2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"})],-1),k(" 複製 ",-1)])],8,Ot),t("button",{onClick:g=>K(s),class:"text-critical-500 hover:text-critical-400 text-sm flex items-center gap-1"},[...e[23]||(e[23]=[t("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),k(" 撤回 ",-1)])],8,Xt)])])]))),128))])]))])])):m("",!0),o(B)?(i(),l("div",Jt,[t("div",Wt,[t("div",{class:"flex items-center justify-between mb-6"},[e[26]||(e[26]=t("h3",{class:"text-xl font-bold text-white"},"產生邀請連結",-1)),t("button",{onClick:A,class:"text-slate-400 hover:text-white"},[...e[25]||(e[25]=[t("svg",{class:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("form",{onSubmit:et(X,["prevent"])},[t("div",Kt,[e[27]||(e[27]=t("label",{class:"block text-slate-400 text-sm mb-2"},"Email 地址",-1)),_(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>o(c).email=s),type:"email",required:"",placeholder:"輸入要邀請的 Email",class:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white focus:outline-none focus:border-primary-500"},null,512),[[P,o(c).email]])]),t("div",Qt,[e[29]||(e[29]=t("label",{class:"block text-slate-400 text-sm mb-2"},"職位",-1)),_(t("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>o(c).role=s),required:"",class:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white focus:outline-none focus:border-primary-500"},[...e[28]||(e[28]=[t("option",{value:"TEACHER"},"正式老師",-1),t("option",{value:"SUBSTITUTE"},"代課老師",-1)])],512),[[U,o(c).role]])]),t("div",Yt,[e[30]||(e[30]=t("label",{class:"block text-slate-400 text-sm mb-2"},"邀請訊息（選填）",-1)),_(t("textarea",{"onUpdate:modelValue":e[9]||(e[9]=s=>o(c).message=s),rows:"3",placeholder:"輸入邀請訊息...",class:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white focus:outline-none focus:border-primary-500 resize-none"},null,512),[[P,o(c).message]])]),o(h)?(i(),l("div",Zt,[e[31]||(e[31]=t("p",{class:"text-success-500 text-sm font-medium mb-2"},"邀請連結已產生！",-1)),t("div",te,[t("input",{value:o(h).invite_link,readonly:"",class:"flex-1 px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-slate-300 text-sm"},null,8,ee),t("button",{onClick:W,type:"button",class:"px-3 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors"}," 複製 ")])])):m("",!0),t("div",se,[t("button",{type:"button",onClick:A,class:"flex-1 py-3 bg-white/10 text-white rounded-xl hover:bg-white/20 transition-colors"}," 取消 "),t("button",{type:"submit",disabled:o(w),class:"flex-1 py-3 bg-primary-500 text-white rounded-xl hover:bg-primary-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[o(w)?(i(),l("span",ae)):m("",!0),k(" "+n(o(w)?"產生中...":"產生連結"),1)],8,oe)])],32)])])):m("",!0),o(y).show?(i(),l("div",{key:3,class:T(["fixed bottom-6 right-6 px-6 py-3 rounded-xl text-white shadow-lg z-50",o(y).type==="success"?"bg-success-500":"bg-critical-500"])},n(o(y).message),3)):m("",!0)]))}});export{re as default};
