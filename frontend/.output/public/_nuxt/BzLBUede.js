import{g as E,C as N,j as U,k as $,l as D,c as r,a as t,p as m,n as s,t as a,d as C,r as p,O as H,q as x,o as i}from"./Blq0K2QU.js";const R={class:"min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900"},V={class:"relative w-full max-w-md"},z={key:0,class:"bg-white/10 backdrop-blur-xl rounded-2xl p-8 border border-white/20 text-center"},A={key:1,class:"bg-white/10 backdrop-blur-xl rounded-2xl p-8 border border-white/20 text-center"},O={class:"text-slate-400 mb-6"},X={key:2,class:"bg-white/10 backdrop-blur-xl rounded-2xl p-8 border border-white/20"},q={class:"text-center mb-6"},J={class:"text-2xl font-bold text-white mb-1"},P={class:"bg-white/5 rounded-xl p-4 mb-6 space-y-3"},W={class:"flex justify-between items-center"},F={class:"text-white font-medium"},G={class:"flex justify-between items-center"},K={class:"text-white"},Q={class:"flex justify-between items-center"},Y={class:"text-white"},Z={key:0,class:"bg-white/5 rounded-xl p-4 mb-6"},tt={class:"text-slate-200"},et={key:1,class:"space-y-3"},st={key:2,class:"space-y-3"},ot={key:3,class:"space-y-3"},nt=["disabled"],rt={key:0,class:"inline-block w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"},it={key:4,class:"text-center"},at={class:"text-slate-400 mb-6"},dt=E({__name:"[token]",setup(lt){const v=H(),j=N(),w=U(),l=$(),b=x(()=>j.params.token),h=p(!0),c=p(""),n=p(null),d=p(!1),g=p(!1),u=x(()=>l.isAuthenticated&&l.userType==="teacher"),f=x(()=>!u.value||!n.value?!1:l.user?.email===n.value.email),I=x(()=>({TEACHER:"正式老師",SUBSTITUTE:"代課老師"})[n.value?.role]||n.value?.role||"老師"),y=o=>o?new Date(o).toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric"}):"-",T=async()=>{h.value=!0,c.value="";try{const o=await fetch(`${v.public.apiBase}/invitations/${b.value}`),e=await o.json();if(!o.ok)throw new Error(e.message||"邀請不存在或已過期");n.value=e.datas}catch(o){c.value=o.message||"無法載入邀請資訊"}finally{h.value=!1}},S=()=>{localStorage.setItem("invitation_token",b.value);const o=`${v.public.liffUrl}/teacher/login?redirect=${encodeURIComponent(window.location.href)}`;window.location.href=o},k=()=>{localStorage.removeItem("teacher_token"),localStorage.removeItem("invitation_token"),l.logout(),window.location.reload()},_=async()=>{if(!l.user?.id_token){c.value="無法取得登入資訊，請重新登入";return}d.value=!0;try{const o=await fetch(`${v.public.apiBase}/invitations/${b.value}/accept`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_token:l.user.id_token})}),e=await o.json();if(!o.ok)throw new Error(e.message||"接受邀請失敗");g.value=!0,localStorage.removeItem("invitation_token")}catch(o){c.value=o.message||"接受邀請失敗，請稍後再試"}finally{d.value=!1}},B=()=>{w.push("/")},L=()=>{w.push("/teacher/dashboard")},M=()=>{const o=localStorage.getItem("invitation_token");o&&o===b.value&&setTimeout(()=>{u.value&&f.value&&_()},500)};return D(async()=>{await T(),M()}),(o,e)=>(i(),r("div",R,[e[15]||(e[15]=t("div",{class:"absolute inset-0 overflow-hidden pointer-events-none"},[t("div",{class:"absolute -top-40 -right-40 w-80 h-80 bg-primary-500/20 rounded-full blur-3xl"}),t("div",{class:"absolute -bottom-40 -left-40 w-80 h-80 bg-indigo-500/20 rounded-full blur-3xl"})],-1)),t("div",V,[s(h)?(i(),r("div",z,[...e[0]||(e[0]=[t("div",{class:"inline-block w-12 h-12 border-4 border-primary-500 border-t-transparent rounded-full animate-spin mb-4"},null,-1),t("p",{class:"text-slate-300"},"正在載入邀請資訊...",-1)])])):s(c)?(i(),r("div",A,[e[1]||(e[1]=t("div",{class:"w-16 h-16 mx-auto mb-4 rounded-full bg-critical-500/20 flex items-center justify-center"},[t("svg",{class:"w-8 h-8 text-critical-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})])],-1)),e[2]||(e[2]=t("h2",{class:"text-xl font-bold text-white mb-2"},"無法載入邀請",-1)),t("p",O,a(s(c)),1),t("button",{onClick:B,class:"px-6 py-3 bg-primary-500 text-white rounded-xl hover:bg-primary-600 transition-colors"}," 返回首頁 ")])):s(n)?(i(),r("div",X,[t("div",q,[e[3]||(e[3]=t("div",{class:"w-20 h-20 mx-auto mb-4 rounded-full bg-primary-500/20 flex items-center justify-center"},[t("svg",{class:"w-10 h-10 text-primary-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})])],-1)),t("h1",J,a(s(n).center_name||"XX 中心"),1),e[4]||(e[4]=t("p",{class:"text-primary-400 font-medium"},"邀請您加入",-1))]),t("div",P,[t("div",W,[e[5]||(e[5]=t("span",{class:"text-slate-400"},"職位",-1)),t("span",F,a(s(I)),1)]),t("div",G,[e[6]||(e[6]=t("span",{class:"text-slate-400"},"邀請時間",-1)),t("span",K,a(y(s(n).created_at)),1)]),t("div",Q,[e[7]||(e[7]=t("span",{class:"text-slate-400"},"有效期限",-1)),t("span",Y,a(y(s(n).expires_at)),1)])]),s(n).message?(i(),r("div",Z,[e[8]||(e[8]=t("p",{class:"text-slate-400 text-sm mb-2"},"邀請訊息",-1)),t("p",tt,a(s(n).message),1)])):m("",!0),s(u)?s(u)&&!s(f)?(i(),r("div",st,[e[11]||(e[11]=t("div",{class:"bg-critical-500/20 border border-critical-500/30 rounded-xl p-4 text-center"},[t("p",{class:"text-critical-500 font-medium mb-1"},"此邀請不屬於您"),t("p",{class:"text-slate-400 text-sm"},"您目前登入的帳號與邀請不符")],-1)),t("button",{onClick:k,class:"w-full py-3 bg-white/10 text-white rounded-xl hover:bg-white/20 transition-colors"}," 登出並使用其他帳號 ")])):s(u)&&s(f)?(i(),r("div",ot,[e[12]||(e[12]=t("div",{class:"bg-success-500/20 border border-success-500/30 rounded-xl p-4 text-center"},[t("p",{class:"text-success-500 font-medium mb-1"},"歡迎回來！"),t("p",{class:"text-slate-400 text-sm"},"您已登入，可以接受邀請")],-1)),t("button",{onClick:_,disabled:s(d),class:"w-full py-4 bg-primary-500 hover:bg-primary-600 text-white font-medium rounded-xl transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[s(d)?(i(),r("span",rt)):m("",!0),C(" "+a(s(d)?"處理中...":"接受邀請並加入"),1)],8,nt),t("button",{onClick:k,class:"w-full py-3 text-slate-400 hover:text-white transition-colors"}," 使用其他帳號 ")])):m("",!0):(i(),r("div",et,[t("button",{onClick:S,class:"w-full py-4 bg-[#06C755] hover:bg-[#05B54A] text-white font-medium rounded-xl transition-colors flex items-center justify-center gap-3"},[...e[9]||(e[9]=[t("svg",{class:"w-6 h-6",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"})],-1),C(" LINE 快速登入並接受邀請 ",-1)])]),e[10]||(e[10]=t("p",{class:"text-center text-slate-500 text-sm"}," 點擊上方按鈕透過 LINE 登入並接受邀請 ",-1))])),s(g)?(i(),r("div",it,[e[13]||(e[13]=t("div",{class:"w-20 h-20 mx-auto mb-4 rounded-full bg-success-500/20 flex items-center justify-center"},[t("svg",{class:"w-10 h-10 text-success-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1)),e[14]||(e[14]=t("h2",{class:"text-xl font-bold text-white mb-2"},"加入成功！",-1)),t("p",at,"歡迎加入 "+a(s(n).center_name),1),t("button",{onClick:L,class:"px-6 py-3 bg-primary-500 text-white rounded-xl hover:bg-primary-600 transition-colors"}," 前往老師後台 ")])):m("",!0)])):m("",!0)])]))}});export{dt as default};
