import{_ as ye}from"./C0JfvJ3S.js";import{_ as _e}from"./BgMs_EMl.js";import{g as se,r as M,l as ve,Q as Ce,E as Se,c as v,a as e,b as de,t as u,q as A,d as L,F as D,v as P,o as l,L as xe,s as N,D as te,n as s,x as ee,y as U,z as G,H as $e,m as ge,G as Q,p as T,T as be,I as Ee,j as Me,w as Ne}from"./ZcPQy5tI.js";import{c as Te,a as je}from"./DaFB5xze.js";import{g as De,f as ce}from"./DCA5C7h4.js";import{u as ue,_ as Be}from"./Cv6fucyu.js";import{_ as He}from"./CjGf6EYd.js";import{u as Ie}from"./C0b8RNVV.js";import{u as Le}from"./DgepazF8.js";const Pe={class:"h-full flex flex-col glass-card overflow-hidden"},ze={class:"p-4 border-b border-white/10 shrink-0"},Ve={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},Ue={class:"flex items-center gap-4"},Oe={class:"flex items-center gap-2"},Fe={class:"text-lg font-semibold text-slate-100"},We={class:"flex items-center gap-2 ml-auto"},Ge={class:"flex-1 overflow-auto p-4"},Ae={class:"grid sticky top-0 z-10 bg-slate-900/95 backdrop-blur-sm",style:{"grid-template-columns":"80px repeat(7, 1fr)"}},Re={class:"text-sm font-medium text-slate-100"},qe={class:"p-2 border-r border-b border-white/5 text-right text-xs text-slate-400"},Ye={class:"absolute top-0 left-0 right-0 bottom-0 pointer-events-none"},Ke=["onClick"],Qe={class:"font-medium truncate"},Je={class:"text-slate-400 truncate"},Xe={class:"text-slate-500 text-[10px] mt-0.5"},Ze=60,pe=80,et=se({__name:"TeacherScheduleGrid",props:{schedules:{}},emits:["update:weekStart","select-schedule","add-personal-event","add-exception"],setup(b,{emit:m}){const S=m,$=M(null),_=M(100),f=M(a(new Date)),h=A(()=>{const r=new Date(f.value);return r.setDate(r.getDate()+6),r}),H=A(()=>{const r=f.value.toLocaleDateString("zh-TW",{month:"long",day:"numeric"}),n=h.value.toLocaleDateString("zh-TW",{month:"long",day:"numeric",year:"numeric"});return`${r} - ${n}`}),a=r=>{const n=new Date(r),y=n.getDay(),i=n.getDate()-y+(y===0?-6:1);return new Date(n.setDate(i))},B=r=>{f.value=a(new Date(f.value.getTime()+r*7*24*60*60*1e3)),S("update:weekStart",f.value)},O=[0,1,2,3,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],k=[{value:1,name:"週一"},{value:2,name:"週二"},{value:3,name:"週三"},{value:4,name:"週四"},{value:5,name:"週五"},{value:6,name:"週六"},{value:7,name:"週日"}],p=b,d=()=>{if($.value){const r=$.value.offsetWidth;_.value=Math.max(80,(r-pe)/7)}},o=A(()=>{const r=new Set,n=[];for(const y of p.schedules){const i=`${y.id}-${y.weekday}-${y.start_time}`;r.has(i)||(r.add(i),n.push(y))}return n}),x=r=>`${r.toString().padStart(2,"0")}:00`,R=r=>{const{weekday:n,start_hour:y,start_minute:i,duration_minutes:E}=r,J=n-1,oe=pe+J*_.value;let z=0;for(let g=0;g<y;g++)(g>=0&&g<=3||g>=9)&&z++;const q=Ze,ne=z*q,le=i/60*q,re=ne+le,w=E/60*q,t=_.value-4;return{left:`${oe}px`,top:`${re}px`,width:`${t}px`,height:`${w}px`}},F=r=>{if(!r)return"";if(r.has_exception)switch(r.exception_type){case"CANCEL":return"bg-critical-500/30 border border-critical-500/50 line-through";case"RESCHEDULE":return"bg-warning-500/30 border border-warning-500/50";case"SWAP":return"bg-primary-500/30 border border-primary-500/50";default:return"bg-slate-700/80 border border-white/10"}return"bg-slate-700/80 border border-white/10"};return ve(async()=>{if(await Ce(),d(),$.value){const r=new ResizeObserver(()=>{d()});r.observe($.value),Se(()=>{r.disconnect()})}}),(r,n)=>{const y=_e;return l(),v("div",Pe,[e("div",ze,[e("div",Ve,[e("div",Ue,[e("div",Oe,[e("button",{onClick:n[0]||(n[0]=i=>B(-1)),class:"p-2 rounded-lg hover:bg-white/10 transition-colors"},[...n[4]||(n[4]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),e("h2",Fe,u(H.value),1),e("button",{onClick:n[1]||(n[1]=i=>B(1)),class:"p-2 rounded-lg hover:bg-white/10 transition-colors"},[...n[5]||(n[5]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])]),de(y,{placement:"bottom",title:"週期導航",description:"查看不同週期的排課狀況，預設顯示本週。",usage:["點擊左右箭頭切換上週/下週","可跨月、跨年查看"]})])]),e("div",We,[e("button",{onClick:n[2]||(n[2]=i=>r.$emit("add-personal-event")),class:"px-4 py-2 rounded-lg bg-purple-500/20 text-purple-400 hover:bg-purple-500/30 transition-colors flex items-center gap-2 text-sm"},[...n[6]||(n[6]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),L(" 個人行程 ",-1)])]),e("button",{onClick:n[3]||(n[3]=i=>r.$emit("add-exception")),class:"px-4 py-2 rounded-lg bg-warning-500/20 text-warning-400 hover:bg-warning-500/30 transition-colors flex items-center gap-2 text-sm"},[...n[7]||(n[7]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01"})],-1),L(" 請假/調課 ",-1)])])])])]),e("div",Ge,[e("div",{class:"min-w-[600px] relative",ref_key:"calendarContainerRef",ref:$},[e("div",Ae,[n[8]||(n[8]=e("div",{class:"p-2 border-b border-white/10 text-center"},[e("span",{class:"text-xs text-slate-400"},"時段")],-1)),(l(),v(D,null,P(k,i=>e("div",{key:i.value,class:"p-2 border-b border-white/10 text-center"},[e("span",Re,u(i.name),1)])),64))]),(l(),v(D,null,P(O,i=>e("div",{key:i,class:"grid relative",style:{"grid-template-columns":"80px repeat(7, 1fr)"}},[e("div",qe,u(x(i)),1),(l(),v(D,null,P(k,E=>e("div",{key:`${i}-${E.value}`,class:"p-0 min-h-[60px] border-b border-white/5 border-r relative"})),64))])),64)),e("div",Ye,[(l(!0),v(D,null,P(o.value,i=>(l(),v("div",{key:i.key,class:N(["absolute rounded-lg p-2 text-xs cursor-pointer hover:opacity-90 transition-opacity pointer-events-auto",F(i)]),style:xe(R(i)),onClick:E=>r.$emit("select-schedule",i)},[e("div",Qe,u(i.offering_name),1),e("div",Je,u(i.center_name),1),e("div",Xe,u(i.start_time)+" - "+u(i.end_time),1)],14,Ke))),128))])],512)])])}}}),tt={class:"flex items-center justify-between p-4 border-b border-white/10 sticky top-0 bg-slate-900/95 backdrop-blur-sm z-10"},st={class:"text-lg font-semibold text-slate-100"},ot={class:"flex gap-4"},nt={class:"flex-1"},lt={class:"flex-1"},rt={class:"flex gap-4"},it={class:"flex-1"},at={class:"flex-1"},dt={class:"flex gap-2 flex-wrap"},ct=["onClick"],ut={class:"flex gap-3 pt-2"},mt=["disabled"],ft=se({__name:"PersonalEventModal",props:{editingEvent:{}},emits:["close","saved"],setup(b,{emit:m}){const S=b,$=m,_=ue(),f=M(!1),h=A(()=>!!S.editingEvent),H=De(),a=M({title:"",start_date:H,start_time:"09:00",end_date:H,end_time:"10:00",recurrence:"NONE",color_hex:"#6366F1"});te(()=>S.editingEvent,()=>{if(S.editingEvent){const d=new Date(S.editingEvent.start_at),o=new Date(S.editingEvent.end_at);a.value={title:S.editingEvent.title||"",start_date:ce(d),start_time:d.toTimeString().slice(0,5),end_date:ce(o),end_time:o.toTimeString().slice(0,5),recurrence:S.editingEvent.recurrence_rule?.frequency||"NONE",color_hex:S.editingEvent.color||"#6366F1"}}else a.value={title:"",start_date:H,start_time:"09:00",end_date:H,end_time:"10:00",recurrence:"NONE",color_hex:"#6366F1"}},{immediate:!0});const O=["#6366F1","#A855F7","#10B981","#F43F5E","#F59E0B","#3B82F6","#EC4899"],k=(d,o)=>{if(!d||!o)return"";const[x,R,F]=d.split("-").map(Number),[r,n]=o.split(":").map(Number),y=i=>String(i).padStart(2,"0");return`${x}-${y(R)}-${y(F)}T${y(r)}:${y(n)}:00+08:00`},p=async()=>{f.value=!0;try{const d={title:a.value.title,start_at:k(a.value.start_date,a.value.start_time),end_at:k(a.value.end_date,a.value.end_time),color_hex:a.value.color_hex};a.value.recurrence!=="NONE"&&(d.recurrence_rule={frequency:a.value.recurrence,interval:1}),h.value?await _.updatePersonalEvent(S.editingEvent.id,d):await _.createPersonalEvent(d),await _.fetchPersonalEvents(),await _.fetchSchedule(),await Te("儲存成功"),$("saved"),$("close")}catch(d){console.error("Failed to save personal event:",d);const o=d.message||"儲存失敗，請稍後再試";await je(o)}finally{f.value=!1}};return(d,o)=>(l(),v("div",{class:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:o[9]||(o[9]=ee(x=>$("close"),["self"]))},[e("div",{class:"glass-card w-full max-w-lg sm:max-w-xl max-h-[90vh] overflow-y-auto animate-spring",onClick:o[8]||(o[8]=ee(()=>{},["stop"]))},[e("div",tt,[e("h3",st,u(s(h)?"編輯個人行程":"新增個人行程"),1),e("button",{onClick:o[0]||(o[0]=x=>$("close")),class:"p-2 rounded-lg hover:bg-white/10 transition-colors"},[...o[10]||(o[10]=[e("svg",{class:"w-5 h-5 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:ee(p,["prevent"]),class:"p-4 space-y-4"},[e("div",null,[o[11]||(o[11]=e("label",{class:"block text-slate-300 mb-2 font-medium text-sm sm:text-base"},"標題",-1)),U(e("input",{"onUpdate:modelValue":o[1]||(o[1]=x=>s(a).title=x),type:"text",placeholder:"例如：休息時間",class:"input-field text-sm sm:text-base",required:""},null,512),[[G,s(a).title]])]),e("div",ot,[e("div",nt,[o[12]||(o[12]=e("label",{class:"block text-slate-300 mb-2 font-medium text-sm sm:text-base"},"開始日期",-1)),U(e("input",{"onUpdate:modelValue":o[2]||(o[2]=x=>s(a).start_date=x),type:"date",class:"input-field text-sm sm:text-base w-full",required:""},null,512),[[G,s(a).start_date]])]),e("div",lt,[o[13]||(o[13]=e("label",{class:"block text-slate-300 mb-2 font-medium text-sm sm:text-base"},"結束日期",-1)),U(e("input",{"onUpdate:modelValue":o[3]||(o[3]=x=>s(a).end_date=x),type:"date",class:"input-field text-sm sm:text-base w-full",required:""},null,512),[[G,s(a).end_date]])])]),e("div",rt,[e("div",it,[o[14]||(o[14]=e("label",{class:"block text-slate-300 mb-2 font-medium text-sm sm:text-base"},"開始時間",-1)),U(e("input",{"onUpdate:modelValue":o[4]||(o[4]=x=>s(a).start_time=x),type:"time",class:"input-field text-sm sm:text-base w-full",required:""},null,512),[[G,s(a).start_time]])]),e("div",at,[o[15]||(o[15]=e("label",{class:"block text-slate-300 mb-2 font-medium text-sm sm:text-base"},"結束時間",-1)),U(e("input",{"onUpdate:modelValue":o[5]||(o[5]=x=>s(a).end_time=x),type:"time",class:"input-field text-sm sm:text-base w-full",required:""},null,512),[[G,s(a).end_time]])])]),e("div",null,[o[17]||(o[17]=e("label",{class:"block text-slate-300 mb-2 font-medium text-sm sm:text-base"},"重複設定",-1)),U(e("select",{"onUpdate:modelValue":o[6]||(o[6]=x=>s(a).recurrence=x),class:"input-field text-sm sm:text-base"},[...o[16]||(o[16]=[ge('<option value="NONE">不重複</option><option value="DAILY">每天</option><option value="WEEKLY">每週</option><option value="BIWEEKLY">每兩週</option><option value="MONTHLY">每月</option>',5)])],512),[[$e,s(a).recurrence]])]),e("div",null,[o[18]||(o[18]=e("label",{class:"block text-slate-300 mb-2 font-medium text-sm sm:text-base"},"顏色標籤",-1)),e("div",dt,[(l(),v(D,null,P(O,x=>e("button",{key:x,type:"button",onClick:R=>s(a).color_hex=x,class:N(["w-10 h-10 rounded-xl transition-transform hover:scale-110",s(a).color_hex===x?"ring-2 ring-white":""]),style:xe({backgroundColor:x})},null,14,ct)),64))])]),e("div",ut,[e("button",{type:"button",onClick:o[7]||(o[7]=x=>$("close")),class:"flex-1 glass-btn py-2.5 sm:py-3 rounded-xl font-medium text-sm sm:text-base"}," 取消 "),e("button",{type:"submit",disabled:s(f),class:"flex-1 btn-primary py-2.5 sm:py-3 rounded-xl font-medium text-sm sm:text-base"},u(s(f)?"儲存中...":"儲存"),9,mt)])],32)])]))}}),pt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},vt={class:"flex items-center justify-between mb-6"},xt={class:"space-y-4"},gt={class:"flex justify-end gap-3 mt-6"},bt=["disabled"],ht={key:0,class:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},wt=se({__name:"SessionNoteModal",props:{isOpen:{type:Boolean},scheduleItem:{}},emits:["close","saved"],setup(b,{emit:m}){const S=m,$=ue(),_=M(!1),f=Ee({content:"",prepNote:""}),h=A(()=>[{id:"domeMouse",cardGradient:"bg-gradient-to-br from-[#fdfbf7] via-[#faf8f5] to-[#f7f5f0]",titleClass:"text-[#5a524d]",subtitleClass:"text-[#8a7e75]",dayHeaderClass:"bg-[#f5f1ed] border-b border-[#e9e4dc]",itemTitleClass:"text-[#4a4540]",centerClass:"text-[#8a7e75]",cardClass:"bg-[#f8f6f5]",buttonClass:"hover:bg-[#f0ede8] text-[#5a524d]"},{id:"dustyRose",cardGradient:"bg-gradient-to-br from-[#faf5f5] via-[#f8f2f2] to-[#f5eeee]",titleClass:"text-[#6b5555]",subtitleClass:"text-[#9a8888]",dayHeaderClass:"bg-[#f5f0ee] border-b border-[#e5dada]",itemTitleClass:"text-[#5a4a4a]",centerClass:"text-[#9a8888]",cardClass:"bg-[#f8f5f5]",buttonClass:"hover:bg-[#f0ebe9] text-[#6b5555]"},{id:"sageGreen",cardGradient:"bg-gradient-to-br from-[#f7faf7] via-[#f5f7f2] to-[#f2f5ee]",titleClass:"text-[#5a6b55]",subtitleClass:"text-[#8a9e88]",dayHeaderClass:"bg-[#ebf0eb] border-b border-[#dce5dc]",itemTitleClass:"text-[#4a5a45]",centerClass:"text-[#8a9e88]",cardClass:"bg-[#f5f7f5]",buttonClass:"hover:bg-[#ebf0eb] text-[#5a6b55]"},{id:"mutedBlue",cardGradient:"bg-gradient-to-br from-[#f8fafb] via-[#f5f7f9] to-[#f2f5f7]",titleClass:"text-[#565d6b]",subtitleClass:"text-[#7a8a99]",dayHeaderClass:"bg-[#e9eff2] border-b border-[#dce2e8]",itemTitleClass:"text-[#464d5a]",centerClass:"text-[#7a8a99]",cardClass:"bg-[#f5f7f9]",buttonClass:"hover:bg-[#e9eff2] text-[#565d6b]"},{id:"warmBeige",cardGradient:"bg-gradient-to-br from-[#fdfbf7] via-[#faf8f5] to-[#f7f5f0]",titleClass:"text-[#5c5650]",subtitleClass:"text-[#8a847a]",dayHeaderClass:"bg-[#f5f1eb] border-b border-[#e9e4dc]",itemTitleClass:"text-[#4a4540]",centerClass:"text-[#8a847a]",cardClass:"bg-[#faf8f5]",buttonClass:"hover:bg-[#f5f1eb] text-[#5c5650]"},{id:"lavender",cardGradient:"bg-gradient-to-br from-[#faf9fa] via-[#f8f7f8] to-[#f5f5f5]",titleClass:"text-[#5d595f]",subtitleClass:"text-[#8a8088]",dayHeaderClass:"bg-[#f2eef2] border-b border-[#e8e5e8]",itemTitleClass:"text-[#4d494f]",centerClass:"text-[#8a8088]",cardClass:"bg-[#f8f7f8]",buttonClass:"hover:bg-[#f2eef2] text-[#5d595f]"},{id:"warmGrey",cardGradient:"bg-gradient-to-br from-[#fafafa] via-[#f8f8f8] to-[#f5f5f5]",titleClass:"text-[#555555]",subtitleClass:"text-[#888888]",dayHeaderClass:"bg-[#f2f2f2] border-b border-[#e8e8e8]",itemTitleClass:"text-[#454545]",centerClass:"text-[#888888]",cardClass:"bg-[#f8f8f8]",buttonClass:"hover:bg-[#f2f2f2] text-[#555555]"}][0]),H=k=>k?new Date(k).toLocaleDateString("zh-TW",{month:"long",day:"numeric",weekday:"long"}):"",a=async()=>{const k=b.scheduleItem?.rule_id||b.scheduleItem?.data?.id;if(!k||!b.scheduleItem?.date)return;const p=await $.fetchSessionNote(k,b.scheduleItem.date);p?(f.content=p.content||"",f.prepNote=p.prep_note||""):(f.content="",f.prepNote="")};te(()=>b.isOpen,k=>{k&&b.scheduleItem&&a()});const B=()=>{S("close")},O=async()=>{const k=b.scheduleItem?.rule_id||b.scheduleItem?.data?.id;if(!(!k||!b.scheduleItem?.date)){_.value=!0;try{await $.saveSessionNote(k,b.scheduleItem.date,f.content,f.prepNote),S("saved"),B()}catch(p){console.error("Failed to save note:",p)}finally{_.value=!1}}};return(k,p)=>(l(),Q(be,{to:"body"},[b.isOpen?(l(),v("div",pt,[e("div",{class:"absolute inset-0 bg-black/50",onClick:B}),e("div",{class:N(["relative glass-card w-full max-w-lg p-6",s(h).cardGradient])},[e("div",vt,[e("h3",{class:N(["text-lg font-semibold",s(h).titleClass])},"課堂筆記",2),e("button",{onClick:B,class:"p-1 rounded-lg hover:bg-white/10 transition-colors"},[(l(),v("svg",{class:N(["w-5 h-5",s(h).subtitleClass]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...p[2]||(p[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)])],2))])]),e("div",{class:N(["mb-4 p-3 rounded-lg",s(h).dayHeaderClass])},[e("p",{class:N(["font-medium",s(h).itemTitleClass])},u(b.scheduleItem?.title),3),e("p",{class:N(["text-sm",s(h).subtitleClass])},u(H(b.scheduleItem?.date))+" "+u(b.scheduleItem?.start_time)+" - "+u(b.scheduleItem?.end_time),3),b.scheduleItem?.center_name?(l(),v("p",{key:0,class:N(["text-sm",s(h).centerClass])},u(b.scheduleItem.center_name),3)):T("",!0)],2),e("div",xt,[e("div",null,[e("label",{class:N(["block text-sm font-medium mb-2",s(h).subtitleClass])},"教學筆記",2),U(e("textarea",{"onUpdate:modelValue":p[0]||(p[0]=d=>s(f).content=d),rows:"4",class:N(["w-full p-3 rounded-lg border resize-none focus:outline-none focus:ring-2 focus:ring-primary-500/50",[s(h).cardClass,s(h).titleClass]]),placeholder:"記錄本次上課內容、進度、學生表現..."},null,2),[[G,s(f).content]])]),e("div",null,[e("label",{class:N(["block text-sm font-medium mb-2",s(h).subtitleClass])},"備課筆記",2),U(e("textarea",{"onUpdate:modelValue":p[1]||(p[1]=d=>s(f).prepNote=d),rows:"3",class:N(["w-full p-3 rounded-lg border resize-none focus:outline-none focus:ring-2 focus:ring-primary-500/50",[s(h).cardClass,s(h).titleClass]]),placeholder:"下次上課準備事項、教材..."},null,2),[[G,s(f).prepNote]])])]),e("div",gt,[e("button",{onClick:B,class:N(["px-4 py-2 rounded-lg transition-colors",s(h).buttonClass])}," 取消 ",2),e("button",{onClick:O,disabled:s(_),class:N(["px-4 py-2 rounded-lg transition-colors flex items-center gap-2",s(_)?"opacity-50 cursor-not-allowed":"bg-primary-500 text-white hover:bg-primary-600"])},[s(_)?(l(),v("svg",ht,[...p[3]||(p[3]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):T("",!0),L(" "+u(s(_)?"儲存中...":"儲存"),1)],10,bt)])],2)])):T("",!0)]))}}),kt={class:"mb-6",role:"region","aria-label":"今日課表摘要"},yt={class:"grid grid-cols-2 md:grid-cols-4 gap-4",role:"list"},_t={class:"glass-card p-4"},Ct={class:"flex items-center justify-between"},St={class:"text-2xl font-bold text-white mt-1"},$t={class:"mt-2 flex items-center gap-2 text-xs"},Et={class:"text-success-500"},Mt={class:"text-primary-500"},Nt={class:"glass-card p-4"},Tt={class:"flex items-center justify-between"},jt={class:"text-2xl font-bold text-white mt-1"},Dt={class:"mt-2 text-xs text-slate-400 truncate"},Bt={class:"glass-card p-4"},Ht={class:"flex items-center justify-between"},It={class:"text-2xl font-bold text-white mt-1"},Lt={class:"mt-2 text-xs text-slate-400"},Pt={key:0},zt={key:1},Vt={class:"glass-card p-4"},Ut={class:"flex items-center justify-between"},Ot={class:"text-2xl font-bold text-white mt-1"},Ft={class:"mt-2 text-xs text-slate-400"},Wt={key:0,class:"mt-4 glass-card p-4",role:"region","aria-label":"即將開始的課程"},Gt={class:"space-y-2",role:"list"},At=["onClick"],Rt={class:"flex items-center gap-3"},qt={class:"text-primary-500 font-mono text-sm"},Yt={class:"text-white text-sm"},Kt={class:"text-slate-500 text-xs"},Qt={class:"text-xs text-slate-400"},Jt={key:0,class:"mt-3 text-sm text-primary-500 hover:text-primary-400 flex items-center gap-1"},Xt={class:"mb-6 flex flex-wrap gap-3",role:"toolbar","aria-label":"快捷操作"},Zt={class:"mb-4"},es={class:"flex items-center justify-between mb-4"},ts={class:"flex items-center gap-4"},ss={class:"flex items-center gap-1"},os={class:"text-sm font-medium text-slate-200 min-w-[140px] text-center"},ns={class:"flex items-center gap-2"},ls={key:0,class:"text-center py-12 text-slate-500"},rs={key:1,class:"space-y-4"},is={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},as={class:"flex gap-3"},ds={class:"glass-card p-4 animate-pulse"},cs={class:"space-y-2"},us={class:"glass-card w-full max-w-sm"},ms={class:"p-4 border-b border-white/10"},fs={key:0,class:"text-sm text-slate-400 mt-1"},ps={class:"p-4 space-y-3"},Cs=se({__name:"dashboard",setup(b){const m=ue(),S=Ie(),$=Le(),_=Me(),f=M(!1),h=M(null),H=A(()=>{if(!m.schedule)return[];const w=[];return m.schedule.days.forEach(t=>{const g=new Date(t.date),I=g.getDay()===0?7:g.getDay();t.items.forEach(C=>{const[V,W]=C.start_time.split(":").map(Number),[Y,c]=C.end_time.split(":").map(Number),K=Y*60+c-(V*60+W);w.push({id:C.id,key:`${C.id}-${I}-${C.start_time}`,offering_name:C.title,center_name:C.data?.center_name||"",teacher_name:"",weekday:I,start_time:C.start_time,end_time:C.end_time,start_hour:V,start_minute:W,duration_minutes:K,date:t.date,has_exception:C.data?.has_exception||!1,exception_type:C.data?.exception_type||null,data:C.data})})}),w}),a=A(()=>m.weekLabel||"本週"),B=w=>{m.changeWeek(w),m.fetchSchedule().then(()=>{x()}),m.fetchPersonalEvents()},O=w=>{m.weekStart=w},k=w=>{oe(w,w.start_hour,w.date)},p=M({totalSessions:0,completedSessions:0,upcomingSessions:0,inProgressSessions:0,inProgressTeacherNames:[]}),d=M([]),o=M(0),x=()=>{if(!m.schedule)return;const t=ce(new Date),g=m.schedule.days.find(j=>j.date===t);if(!g){p.value={totalSessions:0,completedSessions:0,upcomingSessions:0,inProgressSessions:0,inProgressTeacherNames:[]},d.value=[];return}const I=new Date,C=I.getHours(),V=I.getMinutes();let W=0,Y=0,c=0;const K=[],ie=[];g.items.forEach(j=>{const[ae,he]=j.start_time.split(":").map(Number),[we,ke]=j.end_time.split(":").map(Number),me=ae*60+he,fe=we*60+ke,X=C*60+V;if(X>=fe)W++;else if(X>=me&&X<fe){Y++;const Z=j.data?.center_name||"未知中心";K.includes(Z)||K.push(Z)}else{c++;const Z=me-X;ie.push({id:j.id,time:j.start_time,title:j.title,centerName:j.data?.center_name||"",minutesUntil:Z,data:j.data})}}),ie.sort((j,ae)=>j.minutesUntil-ae.minutesUntil),p.value={totalSessions:g.items.length,completedSessions:W,upcomingSessions:c,inProgressSessions:Y,inProgressTeacherNames:K},d.value=ie},R=()=>{o.value=m.exceptions.filter(w=>w.status==="PENDING").length},F=()=>{_.push("/teacher/exceptions")},r=()=>{_.push("/teacher/export")},n=M(!1),y=M(null),i=M(!1),E=M(null),J=M(null),oe=(w,t,g)=>{E.value=w,J.value=t&&g?{hour:t,date:g}:null,i.value=!0},z=async w=>{const t=E.value;if(!t)return;const g=t.data||{},I=g?.offering_name||t.offering_name||t.title,C=t.date,V=`${t.start_time} - ${t.end_time}`;w==="exception"?_.push({path:"/teacher/exceptions",query:{action:"create",rule_id:g?.id||t.id,course_name:I,original_date:C,original_time:V,center_id:g?.center_id||t.center_id}}):w==="note"&&(y.value={id:t.id,type:"SCHEDULE_RULE",title:t.offering_name||I,start_time:t.start_time,end_time:t.end_time,date:C,room_id:g?.room_id||0,center_id:g?.center_id||0,center_name:g?.center_name||"",status:"APPROVED",data:g},n.value=!0),i.value=!1,E.value=null,J.value=null},q=()=>{i.value=!1,E.value=null,J.value=null},ne=()=>{n.value=!1,y.value=null},le=()=>{},re=()=>{m.fetchPersonalEvents(),m.fetchSchedule().then(()=>{x()})};return ve(()=>{m.fetchCenters(),m.fetchSchedule(),m.fetchPersonalEvents(),m.fetchExceptions(),te(()=>m.schedule,()=>{x()},{immediate:!0}),te(()=>m.exceptions,()=>{R()},{immediate:!0})}),(w,t)=>{const g=ye,I=et,C=ft,V=He,W=Be,Y=wt;return l(),v(D,null,[e("div",kt,[t[25]||(t[25]=e("h2",{class:"text-lg font-semibold text-white mb-4"},"今日課表摘要",-1)),e("div",yt,[e("div",_t,[e("div",Ct,[e("div",null,[t[13]||(t[13]=e("p",{class:"text-sm text-slate-400"},"今日課程",-1)),e("p",St,u(s(p).totalSessions),1)]),t[14]||(t[14]=e("div",{class:"w-10 h-10 rounded-lg bg-primary-500/20 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1))]),e("div",$t,[e("span",Et,u(s(p).completedSessions)+" 已完成",1),t[15]||(t[15]=e("span",{class:"text-slate-600"},"|",-1)),e("span",Mt,u(s(p).upcomingSessions)+" 待上課",1)])]),e("div",Nt,[e("div",Tt,[e("div",null,[t[16]||(t[16]=e("p",{class:"text-sm text-slate-400"},"進行中",-1)),e("p",jt,u(s(p).inProgressSessions),1)]),t[17]||(t[17]=e("div",{class:"w-10 h-10 rounded-lg bg-yellow-500/20 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-yellow-500 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))]),e("div",Dt,u(s(p).inProgressTeacherNames.length>0?s(p).inProgressTeacherNames.join("、"):"無進行中課程"),1)]),e("div",Bt,[e("div",Ht,[e("div",null,[t[18]||(t[18]=e("p",{class:"text-sm text-slate-400"},"即將開始",-1)),e("p",It,u(s(d).length),1)]),t[19]||(t[19]=e("div",{class:"w-10 h-10 rounded-lg bg-secondary-500/20 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-secondary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))]),e("div",Lt,[s(d).length>0?(l(),v("span",Pt,"下一堂 "+u(s(d)[0]?.minutesUntil)+" 分鐘後",1)):(l(),v("span",zt,"今日無課程"))])]),e("div",Vt,[e("div",Ut,[e("div",null,[t[20]||(t[20]=e("p",{class:"text-sm text-slate-400"},"待審核",-1)),e("p",Ot,u(s(o)),1)]),t[21]||(t[21]=e("div",{class:"w-10 h-10 rounded-lg bg-warning-500/20 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-warning-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})])],-1))]),e("div",Ft,[de(g,{to:"/teacher/exceptions",class:"text-primary-500 hover:text-primary-400"},{default:Ne(()=>[...t[22]||(t[22]=[L(" 查看詳情 → ",-1)])]),_:1})])])]),s(d).length>0?(l(),v("div",Wt,[t[24]||(t[24]=e("h3",{class:"text-sm font-medium text-white mb-3"},"即將開始",-1)),e("div",Gt,[(l(!0),v(D,null,P(s(d).slice(0,3),c=>(l(),v("div",{key:c.id,role:"listitem",class:"flex items-center justify-between p-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors cursor-pointer",onClick:K=>w.openItemDetail(c)},[e("div",Rt,[e("span",qt,u(c.time),1),e("div",null,[e("p",Yt,u(c.title),1),e("p",Kt,u(c.centerName),1)])]),e("span",Qt,u(c.minutesUntil)+" 分鐘後",1)],8,At))),128))]),s(d).length>3?(l(),v("button",Jt,[L(" 查看全部 "+u(s(d).length)+" 堂課 ",1),t[23]||(t[23]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))])):T("",!0)])):T("",!0)]),e("div",Xt,[e("button",{onClick:t[0]||(t[0]=c=>f.value=!0),"aria-label":"新增個人行程",class:"px-4 py-2 rounded-lg bg-primary-500/20 text-primary-500 hover:bg-primary-500/30 transition-colors flex items-center gap-2 text-sm"},[...t[26]||(t[26]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),L(" 新增個人行程 ",-1)])]),e("button",{onClick:F,"aria-label":"申請請假或調課",class:"px-4 py-2 rounded-lg bg-warning-500/20 text-warning-500 hover:bg-warning-500/30 transition-colors flex items-center gap-2 text-sm"},[...t[27]||(t[27]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),L(" 請假/調課 ",-1)])]),e("button",{onClick:r,"aria-label":"匯出課表",class:"px-4 py-2 rounded-lg bg-secondary-500/20 text-secondary-500 hover:bg-secondary-500/30 transition-colors flex items-center gap-2 text-sm"},[...t[28]||(t[28]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),L(" 匯出課表 ",-1)])])]),e("div",Zt,[e("div",es,[e("div",ts,[e("div",ss,[e("button",{onClick:t[1]||(t[1]=c=>B(-1)),class:"glass-btn p-2 rounded-lg hover:bg-white/10 transition-colors",title:"上一週"},[...t[29]||(t[29]=[e("svg",{class:"w-5 h-5 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),e("span",os,u(s(a)),1),e("button",{onClick:t[2]||(t[2]=c=>B(1)),class:"glass-btn p-2 rounded-lg hover:bg-white/10 transition-colors",title:"下一週"},[...t[30]||(t[30]=[e("svg",{class:"w-5 h-5 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])])])]),e("div",ns,[e("button",{onClick:t[3]||(t[3]=c=>f.value=!0),class:"px-4 py-2 rounded-lg bg-purple-500/20 text-purple-400 hover:bg-purple-500/30 transition-colors flex items-center gap-2 text-sm"},[...t[31]||(t[31]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),L(" 個人行程 ",-1)])]),e("button",{onClick:F,class:"px-4 py-2 rounded-lg bg-warning-500/20 text-warning-400 hover:bg-warning-500/30 transition-colors flex items-center gap-2 text-sm"},[...t[32]||(t[32]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01"})],-1),L(" 請假/調課 ",-1)])])])]),s(m).schedule?(l(),Q(I,{key:0,schedules:s(H),"week-start":s(m).weekStart,"onUpdate:weekStart":O,onSelectSchedule:k,onAddPersonalEvent:t[4]||(t[4]=c=>f.value=!0),onAddException:F},null,8,["schedules","week-start"])):T("",!0)]),!s(m).schedule&&!s(m).loading?(l(),v("div",ls," 載入中... ")):s(m).loading?(l(),v("div",rs,[e("div",is,[(l(),v(D,null,P(4,c=>e("div",{key:c,class:"glass-card p-4 animate-pulse"},[...t[33]||(t[33]=[ge('<div class="flex items-center justify-between"><div class="flex-1"><div class="h-3 w-16 bg-white/10 rounded mb-2"></div><div class="h-6 w-12 bg-white/10 rounded"></div></div><div class="w-10 h-10 bg-white/10 rounded-lg"></div></div>',1)])])),64))]),e("div",as,[(l(),v(D,null,P(3,c=>e("div",{key:c,class:"h-10 w-32 bg-white/10 rounded-lg animate-pulse"})),64))]),e("div",ds,[t[34]||(t[34]=e("div",{class:"h-10 w-48 bg-white/10 rounded mb-4"},null,-1)),e("div",cs,[(l(),v(D,null,P(5,c=>e("div",{key:c,class:"h-12 bg-white/10 rounded"})),64))])])])):T("",!0),e("button",{onClick:t[5]||(t[5]=c=>f.value=!0),class:"fixed bottom-24 md:bottom-6 right-6 w-14 h-14 rounded-full bg-gradient-to-r from-primary-500 to-secondary-500 flex items-center justify-center shadow-xl hover:scale-110 transition-transform duration-300 z-50"},[...t[35]||(t[35]=[e("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])]),s(f)?(l(),Q(C,{key:2,"editing-event":s(h),onClose:t[6]||(t[6]=c=>{f.value=!1,h.value=null}),onSaved:re},null,8,["editing-event"])):T("",!0),s($).show.value?(l(),Q(V,{key:3,onClose:t[7]||(t[7]=c=>s($).close())})):T("",!0),s(S).isOpen.value?(l(),Q(W,{key:4,onClose:t[8]||(t[8]=c=>s(S).close())})):T("",!0),de(Y,{"is-open":s(n),"schedule-item":s(y),onClose:ne,onSaved:le},null,8,["is-open","schedule-item"]),(l(),Q(be,{to:"body"},[s(i)?(l(),v("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:ee(q,["self"])},[e("div",us,[e("div",ms,[t[36]||(t[36]=e("h3",{class:"text-lg font-semibold text-white"},"選擇操作",-1)),s(E)?(l(),v("p",fs,u(s(E).title),1)):T("",!0)]),e("div",ps,[s(E)&&(s(E).type==="SCHEDULE_RULE"||s(E).type==="CENTER_SESSION")?(l(),v(D,{key:0},[e("button",{onClick:t[9]||(t[9]=c=>z("exception")),class:"w-full p-4 rounded-lg bg-warning-500/20 border border-warning-500/30 hover:bg-warning-500/30 transition-colors text-left"},[...t[37]||(t[37]=[e("div",{class:"flex items-center gap-3"},[e("div",{class:"w-10 h-10 rounded-lg bg-warning-500/30 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-warning-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])]),e("div",null,[e("div",{class:"font-medium text-white"},"課程例外申請"),e("div",{class:"text-xs text-slate-400"},"申請調課、請假或找代課")])],-1)])]),e("button",{onClick:t[10]||(t[10]=c=>z("note")),class:"w-full p-4 rounded-lg bg-primary-500/20 border border-primary-500/30 hover:bg-primary-500/30 transition-colors text-left"},[...t[38]||(t[38]=[e("div",{class:"flex items-center gap-3"},[e("div",{class:"w-10 h-10 rounded-lg bg-primary-500/30 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})])]),e("div",null,[e("div",{class:"font-medium text-white"},"課堂備註"),e("div",{class:"text-xs text-slate-400"},"撰寫或查看課程筆記")])],-1)])])],64)):s(E)&&s(E).type==="PERSONAL_EVENT"?(l(),v(D,{key:1},[e("button",{onClick:t[11]||(t[11]=c=>z("edit")),class:"w-full p-4 rounded-lg bg-success-500/20 border border-success-500/30 hover:bg-success-500/30 transition-colors text-left"},[...t[39]||(t[39]=[e("div",{class:"flex items-center gap-3"},[e("div",{class:"w-10 h-10 rounded-lg bg-success-500/30 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-success-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})])]),e("div",null,[e("div",{class:"font-medium text-white"},"編輯行程"),e("div",{class:"text-xs text-slate-400"},"修改行程時間或內容")])],-1)])]),e("button",{onClick:t[12]||(t[12]=c=>z("note")),class:"w-full p-4 rounded-lg bg-primary-500/20 border border-primary-500/30 hover:bg-primary-500/30 transition-colors text-left"},[...t[40]||(t[40]=[e("div",{class:"flex items-center gap-3"},[e("div",{class:"w-10 h-10 rounded-lg bg-primary-500/30 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])]),e("div",null,[e("div",{class:"font-medium text-white"},"新增備註"),e("div",{class:"text-xs text-slate-400"},"為行程添加備註資訊")])],-1)])])],64)):T("",!0)]),e("div",{class:"p-4 border-t border-white/10"},[e("button",{onClick:q,class:"w-full px-4 py-2 rounded-lg bg-white/5 text-white hover:bg-white/10 transition-colors"}," 取消 ")])])])):T("",!0)]))],64)}}});export{Cs as default};
