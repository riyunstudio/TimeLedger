import{u as pt,a as ft,_ as xt,b as ht}from"./CMR0KPMe.js";import{g as He,c as l,o as n,x as H,a as e,t as i,d as F,r as v,D as gt,l as wt,U as Me,E as yt,G as y,p as c,q as f,y as Be,H as Te,F as $,v as z,s as we,w as je,b as bt,L as ye,V as Ee,T as W,B as Y}from"./Blq0K2QU.js";import{b as Le,u as kt}from"./CyqcL6d0.js";import{f as Z}from"./DCA5C7h4.js";import{u as _t}from"./CnOGT6qf.js";const Ct={class:"flex items-center justify-between p-4 border-b border-white/10 sticky top-0 bg-slate-900/95 backdrop-blur-sm z-10"},$t={class:"text-lg font-semibold text-slate-100"},St={key:0,class:"space-y-4 p-4"},Dt={class:"glass p-3 rounded-xl"},Mt={class:"space-y-2 text-sm"},Bt={class:"flex justify-between"},Tt={class:"text-slate-100"},jt={class:"flex justify-between"},Et={class:"text-slate-100"},Lt={class:"flex justify-between"},zt={class:"text-slate-100"},Ht={class:"flex justify-between"},It={class:"text-slate-100"},At={key:1,class:"text-center py-12 text-slate-500"},Vt=He({__name:"ScheduleDetailPanel",props:{time:{},weekday:{},schedule:{},validation:{}},emits:["close","edit","delete","create","findSubstitute"],setup(p,{emit:ee}){const m=p,P=ee,G=()=>{P("edit")},te=async()=>{if(!await Le(`確定要刪除「${m.schedule?.offering_name}」嗎？`,"刪除確認"))return;await Le("此操作將無法復原，確定要刪除嗎？","再次確認")&&P("delete")};return(I,u)=>(n(),l("div",{class:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm isolate",onClick:u[2]||(u[2]=H(se=>I.$emit("close"),["self"]))},[e("div",{class:"glass-card w-full max-w-md max-h-[90vh] overflow-y-auto animate-spring",onClick:u[1]||(u[1]=H(()=>{},["stop"]))},[e("div",Ct,[e("h3",$t,i(p.schedule?.offering_name||"選擇時段"),1),e("button",{onClick:u[0]||(u[0]=se=>I.$emit("close")),class:"p-2 rounded-lg hover:bg-white/10 transition-colors"},[...u[3]||(u[3]=[e("svg",{class:"w-5 h-5 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),p.schedule?(n(),l("div",St,[e("div",Dt,[u[8]||(u[8]=e("h4",{class:"text-sm font-medium text-slate-300 mb-2"},"課程資訊",-1)),e("div",Mt,[e("div",Bt,[u[4]||(u[4]=e("span",{class:"text-slate-400"},"課程",-1)),e("span",Tt,i(p.schedule.offering_name),1)]),e("div",jt,[u[5]||(u[5]=e("span",{class:"text-slate-400"},"老師",-1)),e("span",Et,i(p.schedule.teacher_name),1)]),e("div",Lt,[u[6]||(u[6]=e("span",{class:"text-slate-400"},"教室",-1)),e("span",zt,i(p.schedule.room_name),1)]),e("div",Ht,[u[7]||(u[7]=e("span",{class:"text-slate-400"},"時間",-1)),e("span",It,i(p.schedule.start_time)+" - "+i(p.schedule.end_time),1)])])]),e("div",{class:"space-y-3"},[e("div",{class:"flex items-center gap-2"},[e("button",{onClick:G,class:"flex-1 glass-btn py-3 rounded-xl font-medium flex items-center justify-center gap-2"},[...u[9]||(u[9]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 0L21.828 3.172a2 2 0 010-2.828l-7-7a2 2 0 00-2.828 0L2.172 20.828a2 2 0 010 2.828l7 7a2 2 0 0012.828 0l7.172-7.172z"})],-1),F(" 編輯 ",-1)])])]),e("div",{class:"flex items-center gap-2"},[e("button",{onClick:te,class:"flex-1 btn-critical py-3 rounded-xl font-medium flex items-center justify-center gap-2"},[...u[10]||(u[10]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),F(" 刪除 ",-1)])])])])])):(n(),l("div",At," 點擊左側網格查看詳情 "))])]))}}),Rt={class:"h-full flex flex-col glass-card overflow-hidden"},Nt={class:"p-4 border-b border-white/10 shrink-0"},Ot={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},Ut={class:"flex items-center gap-4"},Wt={class:"flex items-center gap-2"},Ft={class:"text-lg font-semibold text-slate-100"},Pt={key:0,class:"flex items-center gap-3"},Gt={class:"flex items-center gap-2"},qt=["value"],Jt={class:"flex items-center gap-2"},Kt=["value"],Qt={class:"flex items-center gap-2 ml-auto"},Xt={key:0,class:"mt-3 flex items-center gap-2 px-3 py-2 bg-primary-500/10 border border-primary-500/30 rounded-lg"},Yt={key:0,class:"inline-flex items-center gap-1 px-2 py-1 bg-primary-500/20 rounded text-sm"},Zt={class:"text-white"},es={key:1,class:"inline-flex items-center gap-1 px-2 py-1 bg-primary-500/20 rounded text-sm"},ts={class:"text-white"},ss={class:"grid sticky top-0 z-10 bg-slate-900/95 backdrop-blur-sm",style:{"grid-template-columns":"80px repeat(7, 1fr)"}},os={class:"text-sm font-medium text-slate-100"},ns={class:"relative"},ls={class:"p-2 border-r border-b border-white/5 text-right text-xs text-slate-400"},as=["onDragenter"],rs={class:"absolute top-0 left-0 right-0 bottom-0 pointer-events-none z-10"},is=["onClick"],ds={class:"font-medium truncate text-white"},us={class:"text-slate-400 truncate text-[10px]"},cs=["onClick"],vs={class:"font-medium truncate"},ms={key:0,class:"text-slate-400 truncate"},ps={key:1,class:"text-slate-400 truncate"},fs={class:"text-slate-500 text-[10px] mt-0.5"},xs=["onClick"],hs={class:"flex items-center justify-center h-full"},gs={class:"text-warning-400 font-bold text-lg"},ws={class:"glass-card w-full max-w-sm"},ys={class:"p-4 border-b border-white/10"},bs={key:0,class:"text-sm text-slate-400 mt-1"},ks={class:"p-4 space-y-3"},_s={class:"glass-card w-full max-w-sm"},Cs={class:"p-4 border-b border-white/10"},$s={key:0,class:"text-sm text-slate-400 mt-1"},Ss={class:"max-h-96 overflow-y-auto"},Ds=["onClick"],Ms={class:"flex items-center justify-between"},Bs={class:"font-medium text-white"},Ts={class:"text-sm text-slate-400 mt-1"},js={key:0,class:"text-xs text-slate-500 mt-1"},Es={key:1,class:"text-xs text-slate-500 mt-1"},Ls={key:0,class:"text-xs text-slate-500"},zs=60,ze=80,Ns=He({__name:"ScheduleGrid",props:{mode:{},schedules:{},apiEndpoint:{},cardInfoType:{},showMatrixView:{type:Boolean},showViewModeSelector:{type:Boolean},showCreateButton:{type:Boolean},showPersonalEventButton:{type:Boolean},showExceptionButton:{type:Boolean},showExportButton:{type:Boolean},showHelpTooltip:{type:Boolean}},emits:["selectCell","update:weekStart","select-schedule","add-personal-event","add-exception","export","edit-personal-event","delete-personal-event","personal-event-note"],setup(p,{emit:ee}){const m=p,P=f(()=>m.apiEndpoint||"/admin/expand-rules"),G=f(()=>m.cardInfoType||"teacher"),te=f(()=>m.showCreateButton??!0),I=f(()=>m.showPersonalEventButton??!1),u=f(()=>m.showExceptionButton??!1),se=f(()=>m.showExportButton??!1),q=f(()=>m.showHelpTooltip??!0),M=ee,{confirm:Ie,error:be}=kt(),{resourceCache:J,fetchAllResources:Ae}=pt();_t();const A=v(null),oe=v(100),ne=v(!1),le=v(!1),V=v(!1),S=v(null),K=v(""),ae=v(null),b=v(null),w=v(null),B=v({}),re=v(!1),j=v(null),ie=v(!1),de=v([]),E=v(null),ke=s=>{const t=new Date(s),r=t.getDay(),d=t.getDate()-r+(r===0?-6:1);return new Date(t.setDate(d))},D=v(ke(new Date)),_e=f(()=>{const s=new Date(D.value);return s.setDate(s.getDate()+6),s}),Ve=f(()=>{const s=D.value.toLocaleDateString("zh-TW",{month:"long",day:"numeric"}),t=_e.value.toLocaleDateString("zh-TW",{month:"long",day:"numeric",year:"numeric"});return`${s} - ${t}`}),_=v(null),C=v(null),Re=f(()=>Array.from(J.value.teachers.values())),Ne=f(()=>Array.from(J.value.rooms.values())),Oe=f(()=>{const s=J.value.teachers.get(_.value);return s?s.name:""}),Ue=f(()=>{const s=J.value.rooms.get(C.value);return s?s.name:""}),We=()=>{_.value=null},Fe=()=>{C.value=null},Pe=()=>{_.value=null,C.value=null},Ge=[0,1,2,3,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],Ce=[{value:1,name:"週一"},{value:2,name:"週二"},{value:3,name:"週三"},{value:4,name:"週四"},{value:5,name:"週五"},{value:6,name:"週六"},{value:7,name:"週日"}],ue=v([]),$e=s=>{D.value=ke(new Date(D.value.getTime()+s*7*24*60*60*1e3)),M("update:weekStart",D.value)};gt(D,async()=>{(!m.schedules||m.schedules.length===0)&&await R()});const R=async()=>{try{const s=Y(),t=Z(D.value),r=Z(_e.value);let d;m.mode==="teacher"?d=await s.get("/teacher/schedules",{start_date:t,end_date:r}):d=await s.post(P.value,{rule_ids:[],start_date:t,end_date:r});const k=(d.datas||[]).map(a=>{const g=new Date(a.date),o=g.getDay()===0?7:g.getDay(),h=a.start_time||"09:00",T=a.end_time||"10:00",[L,he]=h.split(":").map(Number),ge=Xe(h,T);return{id:a.rule_id||a.id,key:`${a.rule_id||a.id}-${o}-${h}-${a.date}`,offering_name:a.offering_name||"-",teacher_name:a.teacher_name||"-",teacher_id:a.teacher_id,center_name:a.center_name||"-",center_id:a.center_id,room_id:a.room_id,room_name:a.room_name||"-",weekday:o,start_time:h,end_time:T,start_hour:L,start_minute:he,duration_minutes:ge,date:a.date,has_exception:a.has_exception||!1,exception_type:a.exception_type||null,exception_info:a.exception_info||null,rule:a.rule||null,offering_id:a.offering_id,effective_range:a.effective_range||null}});ue.value=k,await Me(),ve()}catch(s){console.error("Failed to fetch schedules:",s),ue.value=[]}},Se=f(()=>{const s=m.schedules&&m.schedules.length>0?m.schedules:ue.value,t=new Set,r=[];for(const d of s){const x=`${d.id}-${d.weekday}-${d.start_time}`;t.has(x)||(t.add(x),r.push(d))}return r}),qe=f(()=>{const s={};for(const t of N.value){const r=`${t.weekday}-${t.start_hour}-${t.start_minute}`;s[r]=(s[r]||0)+1}return s}),ce=s=>{const t=`${s.weekday}-${s.start_hour}-${s.start_minute}`;return qe.value[t]||1},Je=s=>{const t=`${s.weekday}-${s.start_hour}-${s.start_minute}`,r=N.value.filter(d=>`${d.weekday}-${d.start_hour}-${d.start_minute}`===t);return r.sort((d,x)=>d.id-x.id),r[0]?.id===s.id},Ke=s=>N.value.filter(t=>t.weekday===s.weekday&&t.start_hour===s.start_hour&&t.start_minute===s.start_minute),N=f(()=>!_.value&&!C.value?Se.value:Se.value.filter(s=>{const t=!_.value||s.teacher_id===_.value,r=!C.value||s.room_id===C.value;return t&&r})),Qe=f(()=>{const s=N.value;return s.length<50,s}),ve=()=>{if(A.value){const s=A.value.offsetWidth;oe.value=Math.max(80,(s-ze)/7)}},Xe=(s,t)=>{const[r,d]=s.split(":").map(Number),[x,k]=t.split(":").map(Number),a=r*60+d;let g=x*60+k;return g<=a&&(g+=1440),g-a},me=s=>`${s.toString().padStart(2,"0")}:00`,Ye=s=>["週日","週一","週二","週三","週四","週五","週六"][s-1]||"",pe=s=>{const{weekday:t,start_hour:r,start_minute:d,duration_minutes:x}=s,k=t-1,a=ze+k*oe.value;let g=0;for(let U=0;U<r;U++)(U>=0&&U<=3||U>=9)&&g++;const o=zs,h=g*o,T=d/60*o,L=h+T,he=x/60*o,ge=oe.value-4;return{left:`${a}px`,top:`${L}px`,width:`${ge}px`,height:`${he}px`}},Ze=(s,t)=>{const r=`${s}-${t}`,d=B.value[r];return d?.valid===!1?"bg-critical-500/10 border-critical-500/50":d?.warning?"bg-warning-500/10 border-warning-500/50":d?.valid===!0?"bg-success-500/10 border-success-500/50":"hover:bg-white/5"},De=s=>{if(!s)return"";if(s.is_personal_event)return s.color_hex,"border border-white/20";if(s.has_exception)switch(s.exception_type){case"CANCEL":return"bg-critical-500/30 border border-critical-500/50 line-through";case"RESCHEDULE":return"bg-warning-500/30 border border-warning-500/50";case"SWAP":return"bg-primary-500/30 border border-primary-500/50";default:return"bg-slate-700/80 border border-white/10"}return"bg-slate-700/80 border border-white/10"},Q=s=>{m.mode==="teacher"?(j.value=s,re.value=!0,M("select-schedule",s)):(b.value=s,M("selectCell",{time:s.start_hour,weekday:s.weekday}))},fe=()=>{re.value=!1,j.value=null},et=()=>{b.value=null,ae.value=null},tt=s=>{const t=Ke(s);t.length===1?Q(s):(de.value=t,E.value={weekday:s.weekday,start_hour:s.start_hour,start_minute:s.start_minute},ie.value=!0)},xe=()=>{ie.value=!1,de.value=[],E.value=null},st=s=>{Q(s),xe()},O=s=>{const t=j.value;t&&(t.is_personal_event?s==="edit"?M("edit-personal-event",t):s==="delete"?M("delete-personal-event",t):s==="note"&&setTimeout(()=>{M("personal-event-note",{...t,action:"note"})},100):s==="exception"?M("add-exception",t):s==="note"&&setTimeout(()=>{M("select-schedule",{...t,action:"note"})},100),fe())},ot=()=>{b.value&&(S.value=b.value,V.value=!0)},nt=()=>{V.value=!1,S.value=null},lt=s=>{K.value=s,V.value=!1,le.value=!0},at=()=>{le.value=!1,S.value=null,K.value=""},rt=async()=>{if(!(!await Ie("確定要刪除此排課規則？")||!b.value))try{await Y().delete(`/admin/rules/${b.value.id}`),ae.value=null,b.value=null,await R()}catch(t){console.error("Failed to delete rule:",t),await be("刪除失敗，請稍後再試")}},it=async(s,t)=>{try{await Y().put(`/admin/rules/${S.value.id}`,{...s,update_mode:t}),await R(),ae.value=null,b.value=null,S.value=null,K.value=""}catch(r){console.error("Failed to update rule:",r),await be("更新失敗，請稍後再試")}},dt=()=>{R()},ut=s=>{if(w.value){const t=`${w.value.time}-${w.value.day}`;B.value[t]={valid:!0}}},ct=(s,t)=>{w.value={time:s,day:t}},vt=()=>{if(w.value){const s=`${w.value.time}-${w.value.day}`;delete B.value[s]}w.value=null},mt=async s=>{if(s.preventDefault(),!w.value)return;const t=s.dataTransfer?.getData("application/json");if(!t)return;const r=JSON.parse(t),{type:d,item:x}=r,k=`${w.value.time}-${w.value.day}`;B.value[k]={valid:"checking"};try{const a=Y(),g=d==="teacher"?x.id:x.teacher_id||null,o=d==="room"?x.id:x.room_id||null,h=await a.post("/admin/scheduling/check-overlap",{teacher_id:g,room_id:o,start_time:`${Z(D.value)}T${me(w.value.time)}:00`,end_time:`${Z(D.value)}T${me(w.value.time+1)}:00`});h.data.valid?B.value[k]={valid:!0}:B.value[k]={valid:!1,conflicts:h.data.conflicts}}catch(a){console.error("Validation failed:",a),B.value[k]={valid:!1,error:!0}}w.value=null},X=v(null);return wt(async()=>{(!m.schedules||m.schedules.length===0)&&await R(),m.mode==="admin"&&Ae(),await Me(),ve(),A.value&&(X.value=new ResizeObserver(()=>{ve()}),X.value.observe(A.value))}),yt(()=>{X.value&&X.value.disconnect()}),(s,t)=>{const r=ht,d=Ee("DynamicScrollerItem"),x=Ee("DynamicScroller"),k=Vt,a=ft,g=xt;return n(),l("div",Rt,[e("div",Nt,[e("div",Ot,[e("div",Ut,[e("div",Wt,[e("button",{onClick:t[0]||(t[0]=o=>$e(-1)),class:"p-2 rounded-lg hover:bg-white/10 transition-colors"},[...t[15]||(t[15]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),e("h2",Ft,i(Ve.value),1),e("button",{onClick:t[1]||(t[1]=o=>$e(1)),class:"p-2 rounded-lg hover:bg-white/10 transition-colors"},[...t[16]||(t[16]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])]),q.value?(n(),y(r,{key:0,placement:"bottom",title:"週期導航",description:"查看不同週期的排課狀況，預設顯示本週。",usage:["點擊左右箭頭切換上週/下週","可跨月、跨年查看","所有視角共用同一週期"]})):c("",!0)]),p.mode==="admin"?(n(),l("div",Pt,[e("div",Gt,[Be(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>_.value=o),class:"px-3 py-1.5 rounded-lg text-sm bg-slate-800/80 border border-white/10 text-slate-300 focus:outline-none focus:border-primary-500 min-w-[120px]"},[t[17]||(t[17]=e("option",{value:null},"所有老師",-1)),(n(!0),l($,null,z(Re.value,o=>(n(),l("option",{key:"teacher-"+o.id,value:o.id},i(o.name),9,qt))),128))],512),[[Te,_.value]]),q.value?(n(),y(r,{key:0,title:"老師篩選",description:"選擇特定老師，過濾顯示該老師的課程。",usage:["選擇「所有老師」顯示所有課程","選擇老師僅顯示該老師的課程"]})):c("",!0)]),e("div",Jt,[Be(e("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>C.value=o),class:"px-3 py-1.5 rounded-lg text-sm bg-slate-800/80 border border-white/10 text-slate-300 focus:outline-none focus:border-primary-500 min-w-[120px]"},[t[18]||(t[18]=e("option",{value:null},"所有教室",-1)),(n(!0),l($,null,z(Ne.value,o=>(n(),l("option",{key:"room-"+o.id,value:o.id},i(o.name),9,Kt))),128))],512),[[Te,C.value]]),q.value?(n(),y(r,{key:0,title:"教室篩選",description:"選擇特定教室，過濾顯示該教室的課程。",usage:["選擇「所有教室」顯示所有課程","選擇教室僅顯示該教室的課程"]})):c("",!0)])])):c("",!0)]),e("div",Qt,[te.value?(n(),l($,{key:0},[e("button",{onClick:t[4]||(t[4]=o=>ne.value=!0),class:"btn-primary px-4 py-2 text-sm font-medium"}," + 新增排課規則 "),q.value?(n(),y(r,{key:0,title:"新增排課規則",description:"建立新的課程排課規則，設定課程、老師、教室、時間等資訊。",usage:["點擊按鈕開啟新增表單","選擇課程、老師、教室","設定每週固定上課日與時段","設定有效期限後儲存"],shortcut:"Ctrl + N"})):c("",!0)],64)):c("",!0),I.value?(n(),l("button",{key:1,onClick:t[5]||(t[5]=o=>s.$emit("add-personal-event")),class:"px-4 py-2 rounded-lg bg-purple-500/20 text-purple-400 hover:bg-purple-500/30 transition-colors flex items-center gap-2 text-sm"},[...t[19]||(t[19]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),F(" 個人行程 ",-1)])])):c("",!0),u.value?(n(),l("button",{key:2,onClick:t[6]||(t[6]=o=>s.$emit("add-exception")),class:"px-4 py-2 rounded-lg bg-warning-500/20 text-warning-400 hover:bg-warning-500/30 transition-colors flex items-center gap-2 text-sm"},[...t[20]||(t[20]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01"})],-1),F(" 請假/調課 ",-1)])])):c("",!0),se.value?(n(),l("button",{key:3,onClick:t[7]||(t[7]=o=>s.$emit("export")),class:"px-4 py-2 rounded-lg bg-secondary-500/20 text-secondary-500 hover:bg-secondary-500/30 transition-colors flex items-center gap-2 text-sm"},[...t[21]||(t[21]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),F(" 匯出 ",-1)])])):c("",!0)])]),p.mode==="admin"&&(_.value!==null||C.value!==null)?(n(),l("div",Xt,[t[24]||(t[24]=e("span",{class:"text-sm text-primary-400"},"已篩選：",-1)),_.value!==null?(n(),l("span",Yt,[e("span",Zt,i(Oe.value),1),e("button",{onClick:We,class:"hover:text-primary-300"},[...t[22]||(t[22]=[e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):c("",!0),C.value!==null?(n(),l("span",es,[e("span",ts,i(Ue.value),1),e("button",{onClick:Fe,class:"hover:text-primary-300"},[...t[23]||(t[23]=[e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):c("",!0),_.value!==null||C.value!==null?(n(),l("button",{key:2,onClick:Pe,class:"ml-auto text-xs text-slate-400 hover:text-white transition-colors"}," 清除全部 ")):c("",!0)])):c("",!0)]),e("div",{class:"flex-1 overflow-auto p-4",onDragover:H(ut,["prevent"]),onDrop:mt},[e("div",{class:"min-w-[600px] relative",ref_key:"calendarContainerRef",ref:A},[e("div",ss,[t[25]||(t[25]=e("div",{class:"p-2 border-b border-white/10 text-center"},[e("span",{class:"text-xs text-slate-400"},"時段")],-1)),(n(),l($,null,z(Ce,o=>e("div",{key:o.value,class:"p-2 border-b border-white/10 text-center"},[e("span",os,i(o.name),1)])),64))]),e("div",ns,[(n(),l($,null,z(Ge,o=>e("div",{key:o,class:"grid relative z-0",style:{"grid-template-columns":"80px repeat(7, 1fr)"}},[e("div",ls,i(me(o)),1),(n(),l($,null,z(Ce,h=>e("div",{key:`${o}-${h.value}`,class:we(["p-0 min-h-[60px] border-b border-white/5 border-r relative z-0",Ze(o,h.value)]),onDragenter:T=>ct(o,h.value),onDragleave:vt,onDragover:t[8]||(t[8]=H(()=>{},["prevent"]))},null,42,as)),64))])),64)),e("div",rs,[N.value.length>0?(n(),y(x,{key:0,items:Qe.value,"min-item-size":60,class:"h-full","key-field":"key"},{default:je(({item:o,index:h,active:T})=>[bt(d,{item:o,active:T,"size-dependencies":[o.offering_name,o.start_time,o.end_time,o.teacher_name,o.has_exception],"data-index":h},{default:je(()=>[o.is_personal_event?(n(),l("div",{key:0,class:we(["absolute rounded-lg p-2 text-xs cursor-pointer hover:opacity-90 transition-opacity pointer-events-auto",De(o)]),style:ye([pe(o),{backgroundColor:o.color_hex+"40",borderColor:o.color_hex+"60"}]),onClick:L=>Q(o)},[e("div",ds,i(o.offering_name),1),e("div",us,i(o.start_time)+" - "+i(o.end_time),1)],14,is)):(n(),l($,{key:1},[ce(o)===1?(n(),l("div",{key:0,class:we(["absolute rounded-lg p-2 text-xs cursor-pointer hover:opacity-90 transition-opacity pointer-events-auto",De(o)]),style:ye(pe(o)),onClick:L=>Q(o)},[e("div",vs,i(o.offering_name),1),G.value==="teacher"?(n(),l("div",ms,i(o.teacher_name),1)):(n(),l("div",ps,i(o.center_name),1)),e("div",fs,i(o.start_time)+" - "+i(o.end_time),1)],14,cs)):ce(o)>1&&Je(o)?(n(),l("div",{key:1,class:"absolute rounded-lg bg-warning-500/20 border border-warning-500/50 p-2 text-xs cursor-pointer hover:bg-warning-500/30 transition-opacity pointer-events-auto",style:ye(pe(o)),onClick:L=>tt(o)},[e("div",hs,[e("span",gs,i(ce(o)),1),t[26]||(t[26]=e("span",{class:"text-warning-300 ml-1 text-xs"},"堂課程",-1))])],12,xs)):c("",!0)],64))]),_:2},1032,["item","active","size-dependencies","data-index"])]),_:1},8,["items"])):c("",!0)])])],512)],32),(n(),y(W,{to:"body"},[b.value&&p.mode==="admin"?(n(),y(k,{key:0,time:b.value.start_hour,weekday:b.value.weekday,schedule:b.value,onClose:et,onEdit:ot,onDelete:rt},null,8,["time","weekday","schedule"])):c("",!0)])),(n(),y(W,{to:"body"},[V.value&&p.mode==="admin"?(n(),y(a,{key:0,show:V.value,"rule-name":S.value?.offering_name,"rule-date":S.value?.date?new Date(S.value.date).toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric"}):"",onClose:nt,onConfirm:lt},null,8,["show","rule-name","rule-date"])):c("",!0)])),(n(),y(W,{to:"body"},[ne.value&&p.mode==="admin"?(n(),y(g,{key:0,onClose:t[9]||(t[9]=o=>ne.value=!1),onCreated:dt})):c("",!0),le.value&&p.mode==="admin"?(n(),y(g,{key:1,"editing-rule":S.value,"update-mode":K.value,onClose:at,onSubmit:it},null,8,["editing-rule","update-mode"])):c("",!0)])),(n(),y(W,{to:"body"},[re.value&&p.mode==="teacher"?(n(),l("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:H(fe,["self"])},[e("div",ws,[e("div",ys,[t[27]||(t[27]=e("h3",{class:"text-lg font-semibold text-white"},"選擇操作",-1)),j.value?(n(),l("p",bs,i(j.value.offering_name),1)):c("",!0)]),e("div",ks,[j.value?.is_personal_event?(n(),l($,{key:0},[e("button",{onClick:t[10]||(t[10]=o=>O("edit")),class:"w-full p-4 rounded-lg bg-success-500/20 border border-success-500/30 hover:bg-success-500/30 transition-colors text-left"},[...t[28]||(t[28]=[e("div",{class:"flex items-center gap-3"},[e("div",{class:"w-10 h-10 rounded-lg bg-success-500/30 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-success-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})])]),e("div",null,[e("div",{class:"font-medium text-white"},"編輯行程"),e("div",{class:"text-xs text-slate-400"},"修改行程時間或內容")])],-1)])]),e("button",{onClick:t[11]||(t[11]=o=>O("note")),class:"w-full p-4 rounded-lg bg-primary-500/20 border border-primary-500/30 hover:bg-primary-500/30 transition-colors text-left"},[...t[29]||(t[29]=[e("div",{class:"flex items-center gap-3"},[e("div",{class:"w-10 h-10 rounded-lg bg-primary-500/30 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])]),e("div",null,[e("div",{class:"font-medium text-white"},"行程備註"),e("div",{class:"text-xs text-slate-400"},"為行程添加備註資訊")])],-1)])]),e("button",{onClick:t[12]||(t[12]=o=>O("delete")),class:"w-full p-4 rounded-lg bg-critical-500/20 border border-critical-500/30 hover:bg-critical-500/30 transition-colors text-left"},[...t[30]||(t[30]=[e("div",{class:"flex items-center gap-3"},[e("div",{class:"w-10 h-10 rounded-lg bg-critical-500/30 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-critical-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])]),e("div",null,[e("div",{class:"font-medium text-white"},"刪除行程"),e("div",{class:"text-xs text-slate-400"},"移除此個人行程")])],-1)])])],64)):(n(),l($,{key:1},[e("button",{onClick:t[13]||(t[13]=o=>O("exception")),class:"w-full p-4 rounded-lg bg-warning-500/20 border border-warning-500/30 hover:bg-warning-500/30 transition-colors text-left"},[...t[31]||(t[31]=[e("div",{class:"flex items-center gap-3"},[e("div",{class:"w-10 h-10 rounded-lg bg-warning-500/30 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-warning-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])]),e("div",null,[e("div",{class:"font-medium text-white"},"課程例外申請"),e("div",{class:"text-xs text-slate-400"},"申請調課、請假或找代課")])],-1)])]),e("button",{onClick:t[14]||(t[14]=o=>O("note")),class:"w-full p-4 rounded-lg bg-primary-500/20 border border-primary-500/30 hover:bg-primary-500/30 transition-colors text-left"},[...t[32]||(t[32]=[e("div",{class:"flex items-center gap-3"},[e("div",{class:"w-10 h-10 rounded-lg bg-primary-500/30 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})])]),e("div",null,[e("div",{class:"font-medium text-white"},"課堂備註"),e("div",{class:"text-xs text-slate-400"},"撰寫或查看課程筆記")])],-1)])])],64))]),e("div",{class:"p-4 border-t border-white/10"},[e("button",{onClick:fe,class:"w-full px-4 py-2 rounded-lg bg-white/5 text-white hover:bg-white/10 transition-colors"}," 取消 ")])])])):c("",!0)])),(n(),y(W,{to:"body"},[ie.value&&p.mode==="admin"?(n(),l("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:H(xe,["self"])},[e("div",_s,[e("div",Cs,[t[33]||(t[33]=e("h3",{class:"text-lg font-semibold text-white"},"選擇課程",-1)),E.value?(n(),l("p",$s,i(Ye(E.value.weekday))+" "+i(E.value.start_hour.toString().padStart(2,"0"))+":"+i(E.value.start_minute.toString().padStart(2,"0")),1)):c("",!0)]),e("div",Ss,[(n(!0),l($,null,z(de.value,o=>(n(),l("div",{key:o.id,class:"p-4 border-b border-white/5 hover:bg-white/5 cursor-pointer transition-colors",onClick:h=>st(o)},[e("div",Ms,[e("div",null,[e("div",Bs,i(o.offering_name),1),e("div",Ts,i(o.start_time)+" - "+i(o.end_time),1),G.value==="teacher"?(n(),l("div",js,i(o.teacher_name),1)):(n(),l("div",Es,i(o.center_name),1))]),o.room_name?(n(),l("div",Ls,i(o.room_name),1)):c("",!0)])],8,Ds))),128))]),e("div",{class:"p-4 border-t border-white/10"},[e("button",{onClick:xe,class:"w-full px-4 py-2 rounded-lg bg-white/5 text-white hover:bg-white/10 transition-colors"}," 取消 ")])])])):c("",!0)]))])}}});export{Ns as _};
