import{_ as V}from"./I2B9aQUP.js";import{_ as P}from"./Df0LH2Y8.js";import{a as D,u as E}from"./DtFpNjUJ.js";import{g as U,j as L,l as z,c as p,a as t,G as A,p as x,b as F,t as o,n as s,F as k,v as H,d as G,B as W,r as b,o as r,q as $}from"./Blq0K2QU.js";import"./CMR0KPMe.js";import"./DCA5C7h4.js";import"./CnOGT6qf.js";import"./CyqcL6d0.js";const q={class:"p-4 md:p-6"},I={class:"mb-6"},R={class:"flex items-center justify-between mb-4"},J={class:"text-sm text-slate-400"},K={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4"},O={class:"glass-card p-4"},Q={class:"flex items-center justify-between"},X={class:"text-2xl font-bold text-white mt-1"},Y={class:"mt-2 flex items-center gap-2 text-xs"},Z={class:"text-success-500"},tt={class:"text-primary-500"},et={class:"glass-card p-4"},st={class:"flex items-center justify-between"},ot={class:"text-2xl font-bold text-white mt-1"},nt={class:"mt-2 text-xs text-slate-400"},it={class:"flex items-center justify-between"},at={class:"text-2xl font-bold text-white mt-1"},lt={class:"mt-2 text-xs text-slate-400"},rt={class:"glass-card p-4"},ct={class:"flex items-center justify-between"},dt={class:"text-2xl font-bold text-white mt-1"},mt={class:"mt-2 text-xs text-slate-400"},pt={key:0,class:"glass-card p-4"},ut={class:"space-y-2"},ht={class:"flex items-center gap-3"},xt={class:"text-primary-500 font-mono text-sm"},gt={class:"text-white text-sm"},ft={class:"text-slate-500 text-xs"},vt={class:"text-xs text-slate-400"},Tt=U({__name:"dashboard",setup(_t){const S=D(),g=E(),f=L(),C=()=>{f.push("/admin/approval")},N=$(()=>new Date),j=d=>d.toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric",weekday:"long"}),n=b({totalSessions:0,completedSessions:0,upcomingSessions:0,inProgressSessions:0,inProgressTeacherNames:[],pendingExceptions:0,changesCount:0,hasScheduleChanges:!1}),c=b([]),T=async()=>{try{const e=await W().get("/admin/dashboard/today-summary");if(e.datas){const u=e.datas.sessions||[],l=new Date;let i=0,v=0,_=0;const w=[],h=[];u.forEach(a=>{const m=new Date(a.start_time),y=new Date(a.end_time);if(l>=y)i++;else if(l>=m&&l<y)v++,w.push(a.teacher?.name||"未知老師");else{_++;const M=Math.floor((m.getTime()-l.getTime())/6e4);h.push({id:a.id,time:m.toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"}),courseName:a.offering?.name||"未知課程",teacherName:a.teacher?.name||"未知老師",roomName:a.room?.name||"未知教室",minutesUntil:M})}}),h.sort((a,m)=>a.minutesUntil-m.minutesUntil),n.value={totalSessions:e.datas.totalSessions||u.length,completedSessions:i,upcomingSessions:_,inProgressSessions:v,inProgressTeacherNames:w,pendingExceptions:e.datas.pendingExceptions||0,changesCount:e.datas.changesCount||0,hasScheduleChanges:e.datas.hasScheduleChanges||!1},c.value=h}}catch(d){console.error("Failed to fetch today stats:",d)}},B=()=>{f.push("/admin/schedules")};return z(async()=>{S.fetchNotifications(),await T()}),(d,e)=>{const u=V,l=P;return r(),p(k,null,[t("div",q,[t("div",I,[t("div",R,[e[1]||(e[1]=t("h2",{class:"text-lg font-semibold text-white"},"今日課表摘要",-1)),t("span",J,o(j(s(N))),1)]),t("div",K,[t("div",O,[t("div",Q,[t("div",null,[e[2]||(e[2]=t("p",{class:"text-sm text-slate-400"},"今日課程",-1)),t("p",X,o(s(n).totalSessions),1)]),e[3]||(e[3]=t("div",{class:"w-10 h-10 rounded-lg bg-primary-500/20 flex items-center justify-center"},[t("svg",{class:"w-5 h-5 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1))]),t("div",Y,[t("span",Z,o(s(n).completedSessions)+" 已完成",1),e[4]||(e[4]=t("span",{class:"text-slate-600"},"|",-1)),t("span",tt,o(s(n).upcomingSessions)+" 待上課",1)])]),t("div",et,[t("div",st,[t("div",null,[e[5]||(e[5]=t("p",{class:"text-sm text-slate-400"},"進行中",-1)),t("p",ot,o(s(n).inProgressSessions),1)]),e[6]||(e[6]=t("div",{class:"w-10 h-10 rounded-lg bg-yellow-500/20 flex items-center justify-center"},[t("svg",{class:"w-5 h-5 text-yellow-500 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))]),t("div",nt,o(s(n).inProgressTeacherNames.length>0?s(n).inProgressTeacherNames.join("、"):"無進行中課程"),1)]),t("button",{onClick:C,class:"glass-card p-4 text-left w-full hover:bg-white/5 transition-colors"},[t("div",it,[t("div",null,[e[7]||(e[7]=t("p",{class:"text-sm text-slate-400"},"待審核",-1)),t("p",at,o(s(n).pendingExceptions),1)]),e[8]||(e[8]=t("div",{class:"w-10 h-10 rounded-lg bg-warning-500/20 flex items-center justify-center"},[t("svg",{class:"w-5 h-5 text-warning-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})])],-1))]),t("div",lt,o(s(n).pendingExceptions>0?"點擊查看詳情":"無待審核項目"),1)]),t("div",rt,[t("div",ct,[t("div",null,[e[9]||(e[9]=t("p",{class:"text-sm text-slate-400"},"異動提醒",-1)),t("p",dt,o(s(n).changesCount),1)]),e[10]||(e[10]=t("div",{class:"w-10 h-10 rounded-lg bg-critical-500/20 flex items-center justify-center"},[t("svg",{class:"w-5 h-5 text-critical-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})])],-1))]),t("div",mt,o(s(n).hasScheduleChanges?"課表有調整":"無異動"),1)])]),s(c).length>0?(r(),p("div",pt,[e[12]||(e[12]=t("h3",{class:"text-sm font-medium text-white mb-3"},"即將開始",-1)),t("div",ut,[(r(!0),p(k,null,H(s(c).slice(0,3),i=>(r(),p("div",{key:i.id,class:"flex items-center justify-between p-2 rounded-lg bg-white/5"},[t("div",ht,[t("span",xt,o(i.time),1),t("div",null,[t("p",gt,o(i.courseName),1),t("p",ft,o(i.teacherName)+" · "+o(i.roomName),1)])]),t("span",vt,o(i.minutesUntil)+" 分鐘後",1)]))),128))]),s(c).length>3?(r(),p("button",{key:0,onClick:B,class:"mt-3 text-sm text-primary-500 hover:text-primary-400 flex items-center gap-1"},[G(" 查看全部 "+o(s(c).length)+" 堂課 ",1),e[11]||(e[11]=t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))])):x("",!0)])):x("",!0)]),F(u,{class:"flex-1 min-w-0",mode:"admin","api-endpoint":"/admin/expand-rules"})]),s(g).show.value?(r(),A(l,{key:0,onClose:e[0]||(e[0]=i=>s(g).close())})):x("",!0)],64)}}});export{Tt as default};
