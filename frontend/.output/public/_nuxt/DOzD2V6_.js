import{u as I}from"./DaFB5xze.js";import{g as z,B as S,l as A,E as H,c as d,a as t,p as N,n,d as m,s as h,m as p,t as o,L,F as R,v as F,r as u,o as c,q as j}from"./ZcPQy5tI.js";import{u as U}from"./pFv8ODIQ.js";import{s as q}from"./DiF-fSc1.js";const V={class:"p-4 md:p-6"},D={class:"flex items-center justify-between mb-6"},E={class:"flex items-center gap-2"},P=["disabled"],T={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6"},Q={class:"glass-card p-4"},W={class:"text-3xl font-bold text-white"},$={class:"glass-card p-4"},G={class:"text-3xl font-bold text-white"},J={class:"glass-card p-4"},K={class:"text-3xl font-bold text-white"},O={class:"glass-card p-4"},X={class:"text-3xl font-bold text-white"},Y={class:"glass-card p-4"},Z={class:"text-3xl font-bold text-white"},tt={key:0,class:"mb-6 p-4 bg-red-500/10 border border-red-500/30 rounded-xl"},et={class:"flex items-center gap-3"},st={class:"text-sm text-slate-400"},nt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ot={class:"glass-card p-6"},lt={class:"space-y-3"},it={class:"flex items-center justify-between p-3 bg-white/5 rounded-lg"},at={class:"flex items-center gap-2"},rt={class:"flex items-center justify-between p-3 bg-white/5 rounded-lg"},dt={class:"text-white font-mono"},ct={class:"flex items-center justify-between p-3 bg-white/5 rounded-lg"},pt={class:"text-white font-mono"},ut={class:"glass-card p-6"},xt={class:"space-y-3"},mt={class:"flex items-center justify-between p-3 bg-white/5 rounded-lg"},vt={class:"text-yellow-400 font-medium"},ft={class:"flex items-center justify-between p-3 bg-white/5 rounded-lg"},gt={class:"text-success-500 font-medium"},ht={class:"flex items-center justify-between p-3 bg-white/5 rounded-lg"},wt={class:"text-red-400 font-medium"},yt={class:"pt-2 border-t border-white/10"},bt={class:"flex items-center justify-between"},_t={class:"text-primary-400 font-bold"},kt={class:"h-2 bg-white/10 rounded-full mt-2 overflow-hidden"},jt={class:"mt-6 glass-card p-6"},Mt={key:0,class:"text-center py-8 text-slate-500"},Ct={key:1,class:"space-y-2"},Bt={class:"flex items-center gap-3"},It={class:"text-white text-sm"},zt={class:"text-xs text-slate-500"},St={class:"text-right"},At={class:"text-xs text-slate-400"},Ht={class:"text-xs text-red-400"},Vt=z({__name:"queue-monitor",setup(Nt){const{warning:Lt}=I(),v=S(),x=u(!1),i=u({pending:"0",retry:"0",total:"0",retried:"0",failed:"0"}),a=u({connected:!1,latency:0,memoryUsage:"0 MB"}),r=u({pending:0,accepted:0,declined:0}),f=u([]),w=j(()=>{const s=parseInt(i.value.total)||0,e=parseInt(i.value.failed)||0;return s===0?0:e/s*100}),y=j(()=>{const s=r.value.accepted+r.value.declined;return s===0?0:Math.round(r.value.accepted/s*100)}),b=async()=>{try{const s=await v.get("/admin/notifications/queue-stats");s.code===0&&s.datas&&(i.value={pending:s.datas.pending||"0",retry:s.datas.retry||"0",total:s.datas.total||"0",retried:s.datas.retried||"0",failed:s.datas.failed||"0"})}catch(s){console.error("Failed to fetch queue stats:",s)}},_=async()=>{try{const s=Date.now(),e=await v.get("/admin/health/redis"),l=Date.now()-s;a.value={connected:e.code===0,latency:l,memoryUsage:e.datas?.memory_usage||"N/A"}}catch{a.value={connected:!1,latency:0,memoryUsage:"N/A"}}},M=async()=>{try{const{getCenterId:s}=U(),e=s(),l=await v.get("/admin/smart-matching/talent/stats");l.code===0&&l.datas&&(r.value={pending:l.datas.pending_invites||0,accepted:l.datas.accepted_invites||0,declined:l.datas.declined_invites||0})}catch(s){console.error("Failed to fetch invitation stats:",s)}},C=async()=>{f.value=[{type:"例外通知",recipient:"管理員 #3",time:"2 分鐘前",error:"LINE API 逾時"},{type:"邀請通知",recipient:"老師 #12",time:"15 分鐘前",error:"無效的 LineUserID"}]},k=async()=>{x.value=!0;try{await Promise.all([b(),_(),M(),C()])}finally{x.value=!1}};let g=null;return A(()=>{k(),g=q(()=>{b(),_()},3e4)}),H(()=>{g&&clearInterval(g)}),(s,e)=>(c(),d("div",V,[t("div",D,[e[2]||(e[2]=t("div",null,[t("h1",{class:"text-2xl font-bold text-white"},"系統監控"),t("p",{class:"text-sm text-slate-400 mt-1"},"監控通知佇列與系統狀態")],-1)),t("div",E,[t("button",{onClick:k,disabled:n(x),class:"px-4 py-2 rounded-lg bg-primary-500 text-white hover:bg-primary-600 transition-colors flex items-center gap-2 disabled:opacity-50"},[(c(),d("svg",{class:h(["w-4 h-4",{"animate-spin":n(x)}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[0]||(e[0]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])],2)),e[1]||(e[1]=m(" 重新整理 ",-1))],8,P)])]),t("div",T,[t("div",Q,[e[3]||(e[3]=p('<div class="flex items-center justify-between mb-2"><div class="w-10 h-10 rounded-lg bg-primary-500/20 flex items-center justify-center"><svg class="w-5 h-5 text-primary-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><span class="text-xs px-2 py-1 rounded-full bg-primary-500/20 text-primary-400">待處理</span></div>',1)),t("p",W,o(n(i).pending),1),e[4]||(e[4]=t("p",{class:"text-xs text-slate-400 mt-1"},"筆等待發送",-1))]),t("div",$,[e[5]||(e[5]=p('<div class="flex items-center justify-between mb-2"><div class="w-10 h-10 rounded-lg bg-yellow-500/20 flex items-center justify-center"><svg class="w-5 h-5 text-yellow-500 animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></div><span class="text-xs px-2 py-1 rounded-full bg-yellow-500/20 text-yellow-400">重試中</span></div>',1)),t("p",G,o(n(i).retry),1),e[6]||(e[6]=t("p",{class:"text-xs text-slate-400 mt-1"},"筆稍後重試",-1))]),t("div",J,[e[7]||(e[7]=p('<div class="flex items-center justify-between mb-2"><div class="w-10 h-10 rounded-lg bg-success-500/20 flex items-center justify-center"><svg class="w-5 h-5 text-success-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><span class="text-xs px-2 py-1 rounded-full bg-success-500/20 text-success-400">已完成</span></div>',1)),t("p",K,o(n(i).total),1),e[8]||(e[8]=t("p",{class:"text-xs text-slate-400 mt-1"},"筆已發送",-1))]),t("div",O,[e[9]||(e[9]=p('<div class="flex items-center justify-between mb-2"><div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center"><svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></div><span class="text-xs px-2 py-1 rounded-full bg-blue-500/20 text-blue-400">已重試</span></div>',1)),t("p",X,o(n(i).retried),1),e[10]||(e[10]=t("p",{class:"text-xs text-slate-400 mt-1"},"筆重新處理",-1))]),t("div",Y,[e[11]||(e[11]=p('<div class="flex items-center justify-between mb-2"><div class="w-10 h-10 rounded-lg bg-red-500/20 flex items-center justify-center"><svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><span class="text-xs px-2 py-1 rounded-full bg-red-500/20 text-red-400">失敗</span></div>',1)),t("p",Z,o(n(i).failed),1),e[12]||(e[12]=t("p",{class:"text-xs text-slate-400 mt-1"},"筆發送失敗",-1))])]),n(w)>10?(c(),d("div",tt,[t("div",et,[e[14]||(e[14]=t("svg",{class:"w-6 h-6 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),t("div",null,[e[13]||(e[13]=t("p",{class:"text-red-400 font-medium"},"警告：失敗率過高",-1)),t("p",st,"当前失败率为 "+o(n(w).toFixed(1))+"%，請檢查 LINE API 連線或通知設定",1)])])])):N("",!0),t("div",nt,[t("div",ot,[e[18]||(e[18]=t("h3",{class:"text-lg font-semibold text-white mb-4 flex items-center gap-2"},[t("svg",{class:"w-5 h-5 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"})]),m(" Redis 連線狀態 ")],-1)),t("div",lt,[t("div",it,[e[15]||(e[15]=t("span",{class:"text-slate-400"},"連線狀態",-1)),t("div",at,[t("span",{class:h(["w-2 h-2 rounded-full",n(a).connected?"bg-success-500":"bg-red-500"])},null,2),t("span",{class:h(n(a).connected?"text-success-500":"text-red-500")},o(n(a).connected?"已連線":"未連線"),3)])]),t("div",rt,[e[16]||(e[16]=t("span",{class:"text-slate-400"},"回應時間",-1)),t("span",dt,o(n(a).latency)+"ms",1)]),t("div",ct,[e[17]||(e[17]=t("span",{class:"text-slate-400"},"記憶體使用",-1)),t("span",pt,o(n(a).memoryUsage),1)])])]),t("div",ut,[e[23]||(e[23]=t("h3",{class:"text-lg font-semibold text-white mb-4 flex items-center gap-2"},[t("svg",{class:"w-5 h-5 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})]),m(" 人才庫邀請統計 ")],-1)),t("div",xt,[t("div",mt,[e[19]||(e[19]=t("span",{class:"text-slate-400"},"待回覆邀請",-1)),t("span",vt,o(n(r).pending),1)]),t("div",ft,[e[20]||(e[20]=t("span",{class:"text-slate-400"},"已接受",-1)),t("span",gt,o(n(r).accepted),1)]),t("div",ht,[e[21]||(e[21]=t("span",{class:"text-slate-400"},"已拒絕",-1)),t("span",wt,o(n(r).declined),1)]),t("div",yt,[t("div",bt,[e[22]||(e[22]=t("span",{class:"text-slate-400"},"回覆率",-1)),t("span",_t,o(n(y))+"%",1)]),t("div",kt,[t("div",{class:"h-full bg-gradient-to-r from-primary-500 to-success-500 transition-all duration-500",style:L({width:`${n(y)}%`})},null,4)])])])])]),t("div",jt,[e[26]||(e[26]=t("h3",{class:"text-lg font-semibold text-white mb-4 flex items-center gap-2"},[t("svg",{class:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),m(" 最近的失敗記錄 ")],-1)),n(f).length===0?(c(),d("div",Mt,[...e[24]||(e[24]=[t("svg",{class:"w-12 h-12 mx-auto mb-3 text-slate-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),t("p",null,"目前沒有失敗記錄",-1)])])):(c(),d("div",Ct,[(c(!0),d(R,null,F(n(f),(l,B)=>(c(),d("div",{key:B,class:"flex items-center justify-between p-3 bg-white/5 rounded-lg hover:bg-white/10 transition-colors"},[t("div",Bt,[e[25]||(e[25]=t("span",{class:"text-red-500"},"✕",-1)),t("div",null,[t("p",It,o(l.type),1),t("p",zt,o(l.recipient),1)])]),t("div",St,[t("p",At,o(l.time),1),t("p",Ht,o(l.error),1)])]))),128))]))])]))}});export{Vt as default};
