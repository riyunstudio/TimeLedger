import{_ as I}from"./Blc-h3lb.js";import{g as j,j as z,O as A,l as E,c as f,a as e,b as n,w,r as m,o as b,d as g,t as i,n as t,s as _,x as L,p as $,q as F}from"./Blq0K2QU.js";import{_ as v}from"./DHaYKDNW.js";import{_ as y}from"./5LwSwYqh.js";import{c as T,a as P,b as O}from"./CyqcL6d0.js";const R={class:"p-4 md:p-6 max-w-4xl mx-auto"},D={class:"p-6"},U={class:"grid md:grid-cols-2 gap-4"},H={class:"bg-white/5 rounded-xl p-4"},W={class:"text-white font-medium"},q={class:"bg-white/5 rounded-xl p-4"},J={class:"text-white font-medium"},G={class:"bg-white/5 rounded-xl p-4"},K={class:"text-white font-medium"},Q={class:"bg-white/5 rounded-xl p-4"},X={class:"text-white font-medium"},Y={class:"p-6"},Z={class:"flex items-center gap-4 pt-2"},ee=["disabled"],se={key:0,class:"flex items-center gap-2"},te={key:1},oe={class:"p-6"},ae={class:"flex items-center justify-between"},le={class:"text-slate-300 mb-1"},re={class:"text-slate-500 text-sm"},we=j({__name:"settings",setup(ne){const B=z(),h=A().public.apiBase,l=m({name:"",email:"",role:"",center_name:""}),c=m({isBound:!1}),o=m({oldPassword:"",newPassword:"",confirmPassword:""}),x=m(!1),d=m(""),u=m(!1),C=async()=>{try{const a=localStorage.getItem("admin_token"),s=await fetch(`${h}/admin/me/profile`,{headers:{Authorization:`Bearer ${a}`}});if(s.ok){const r=await s.json();l.value=r.datas}}catch(a){console.error("取得個人資料失敗:",a)}},S=async()=>{try{const a=localStorage.getItem("admin_token"),s=await fetch(`${h}/admin/me/line-binding`,{headers:{Authorization:`Bearer ${a}`}});if(s.ok){const r=await s.json();c.value={isBound:r.datas.is_bound}}}catch(a){console.error("取得 LINE 綁定狀態失敗:",a)}},V=a=>({OWNER:"擁有者",ADMIN:"管理員",STAFF:"員工"})[a]||a,k=F(()=>o.value.oldPassword.length>=6&&o.value.newPassword.length>=6&&o.value.newPassword===o.value.confirmPassword),M=async()=>{if(k.value){x.value=!0,d.value="",u.value=!1;try{const a=localStorage.getItem("admin_token"),s=await fetch(`${h}/admin/me/change-password`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({old_password:o.value.oldPassword,new_password:o.value.newPassword})}),r=await s.json();s.ok?(u.value=!0,d.value="密碼已成功修改",o.value={oldPassword:"",newPassword:"",confirmPassword:""},await T("密碼已成功修改")):(u.value=!1,d.value=r.message||"修改失敗",await P(r.message||"舊密碼錯誤"))}catch{u.value=!1,d.value="修改失敗，請稍後再試",await P("修改失敗，請稍後再試")}finally{x.value=!1}}},N=async()=>{await O("確定要登出嗎？")&&(localStorage.removeItem("admin_token"),localStorage.removeItem("admin_user"),B.push("/admin/login"))};return E(async()=>{await Promise.all([C(),S()])}),(a,s)=>{const r=I;return b(),f("div",R,[s[16]||(s[16]=e("div",{class:"mb-8"},[e("h1",{class:"text-2xl md:text-3xl font-bold text-slate-100 mb-2"}," 帳號設定 "),e("p",{class:"text-slate-400 text-sm md:text-base"}," 管理您的帳號資訊和密碼 ")],-1)),n(v,{class:"mb-6"},{default:w(()=>[e("div",D,[s[7]||(s[7]=e("h2",{class:"text-lg font-semibold text-white mb-4 flex items-center gap-2"},[e("svg",{class:"w-5 h-5 text-primary-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})]),g(" 個人資料 ")],-1)),e("div",U,[e("div",H,[s[3]||(s[3]=e("p",{class:"text-slate-400 text-sm mb-1"},"姓名",-1)),e("p",W,i(t(l).name||"-"),1)]),e("div",q,[s[4]||(s[4]=e("p",{class:"text-slate-400 text-sm mb-1"},"Email",-1)),e("p",J,i(t(l).email||"-"),1)]),e("div",G,[s[5]||(s[5]=e("p",{class:"text-slate-400 text-sm mb-1"},"角色",-1)),e("p",K,[e("span",{class:_(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",{"bg-purple-500/20 text-purple-400":t(l).role==="OWNER","bg-blue-500/20 text-blue-400":t(l).role==="ADMIN","bg-green-500/20 text-green-400":t(l).role==="STAFF"}])},i(V(t(l).role)),3)])]),e("div",Q,[s[6]||(s[6]=e("p",{class:"text-slate-400 text-sm mb-1"},"所屬中心",-1)),e("p",X,i(t(l).center_name||"-"),1)])])])]),_:1}),n(v,{class:"mb-6"},{default:w(()=>[e("div",Y,[s[12]||(s[12]=e("h2",{class:"text-lg font-semibold text-white mb-4 flex items-center gap-2"},[e("svg",{class:"w-5 h-5 text-primary-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})]),g(" 修改密碼 ")],-1)),e("form",{onSubmit:L(M,["prevent"]),class:"space-y-4"},[e("div",null,[s[8]||(s[8]=e("label",{class:"block text-sm text-slate-400 mb-2"},"舊密碼",-1)),n(y,{modelValue:t(o).oldPassword,"onUpdate:modelValue":s[0]||(s[0]=p=>t(o).oldPassword=p),type:"password",placeholder:"請輸入舊密碼",class:"w-full"},null,8,["modelValue"])]),e("div",null,[s[9]||(s[9]=e("label",{class:"block text-sm text-slate-400 mb-2"},"新密碼",-1)),n(y,{modelValue:t(o).newPassword,"onUpdate:modelValue":s[1]||(s[1]=p=>t(o).newPassword=p),type:"password",placeholder:"請輸入新密碼（至少 6 個字元）",class:"w-full"},null,8,["modelValue"])]),e("div",null,[s[10]||(s[10]=e("label",{class:"block text-sm text-slate-400 mb-2"},"確認新密碼",-1)),n(y,{modelValue:t(o).confirmPassword,"onUpdate:modelValue":s[2]||(s[2]=p=>t(o).confirmPassword=p),type:"password",placeholder:"請再次輸入新密碼",class:"w-full",error:t(o).confirmPassword&&t(o).newPassword!==t(o).confirmPassword?"密碼不一致":""},null,8,["modelValue","error"])]),e("div",Z,[e("button",{type:"submit",disabled:t(x)||!t(k),class:"px-6 py-2.5 bg-primary-500/30 border border-primary-500 text-primary-400 rounded-xl hover:bg-primary-500/40 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[t(x)?(b(),f("span",se,[...s[11]||(s[11]=[e("svg",{class:"animate-spin w-4 h-4",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),g(" 處理中... ",-1)])])):(b(),f("span",te,"更新密碼"))],8,ee),t(d)?(b(),f("span",{key:0,class:_([t(u)?"text-green-400":"text-red-400","text-sm"])},i(t(d)),3)):$("",!0)])],32)])]),_:1}),n(v,{class:"mb-6"},{default:w(()=>[e("div",oe,[s[14]||(s[14]=e("h2",{class:"text-lg font-semibold text-white mb-4 flex items-center gap-2"},[e("svg",{class:"w-5 h-5 text-primary-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})]),g(" LINE 通知設定 ")],-1)),e("div",ae,[e("div",null,[e("p",le,i(t(c).isBound?"已綁定 LINE":"尚未綁定 LINE"),1),e("p",re,i(t(c).isBound?"可接收例外申請通知":"綁定後可接收即時通知"),1)]),n(r,{to:"/admin/line-bind",class:_(["px-6 py-2.5 rounded-xl transition-colors flex items-center gap-2",t(c).isBound?"bg-white/5 text-slate-300 hover:bg-white/10 border border-white/10":"bg-primary-500/30 text-primary-400 hover:bg-primary-500/40 border border-primary-500/50"])},{default:w(()=>[e("span",null,i(t(c).isBound?"管理設定":"立即綁定"),1),s[13]||(s[13]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))]),_:1},8,["class"])])])]),_:1}),n(v,null,{default:w(()=>[e("div",{class:"p-6"},[e("div",{class:"flex items-center justify-between"},[s[15]||(s[15]=e("div",null,[e("p",{class:"text-slate-300 mb-1"},"登出帳號"),e("p",{class:"text-slate-500 text-sm"},"安全的登出您的帳號")],-1)),e("button",{onClick:N,class:"px-6 py-2.5 bg-critical-500/20 border border-critical-500/50 text-critical-400 rounded-xl hover:bg-critical-500/30 transition-colors"}," 登出 ")])])]),_:1})])}}});export{we as default};
