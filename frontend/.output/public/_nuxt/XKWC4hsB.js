import{g as N,j as L,D as I,l as D,c as l,a,y as h,H as _,n as r,m as A,p as w,F as U,v as M,t as p,r as u,B as E,o as n,q as $,s as S}from"./Blq0K2QU.js";const O={class:"p-4 md:p-6 max-w-7xl mx-auto"},H={class:"flex flex-wrap gap-3 mb-6"},W={class:"bg-white/5 rounded-xl border border-white/10 overflow-hidden"},B={key:0,class:"p-8 text-center"},F={key:1,class:"p-8 text-center text-slate-400"},X={key:2,class:"divide-y divide-white/5"},j=["onClick"],z={class:"flex items-start gap-3"},q={class:"flex-1"},G={class:"flex items-center gap-2 mb-1"},J={class:"font-medium text-slate-100 text-sm"},K={key:0,class:"w-2 h-2 rounded-full bg-primary-500 shrink-0"},Q={class:"text-sm text-slate-400"},Y={class:"flex items-center gap-3 mt-2"},Z={class:"text-xs text-slate-500"},ee={key:3,class:"px-4 py-3 bg-white/5 border-t border-white/10 flex items-center justify-between"},te={class:"text-slate-400 text-sm"},se={class:"flex gap-2"},ae=["disabled"],oe=["disabled"],le=N({__name:"notifications",setup(re){const k=L(),m=u(!0),x=u([]),i=u({readStatus:"",type:""}),o=u({page:1,limit:20,total:0,totalPages:0}),C=t=>({APPROVAL:"審核通過",REVIEW_RESULT:"審核結果",EXCEPTION:"例外申請",SCHEDULE:"課表通知",CENTER_INVITE:"中心邀請"})[t]||t,P=t=>{const e=new Date(t),d=new Date().getTime()-e.getTime(),g=Math.floor(d/(1e3*60)),f=Math.floor(d/(1e3*60*60)),b=Math.floor(d/(1e3*60*60*24));return g<1?"剛剛":g<60?`${g} 分鐘前`:f<24?`${f} 小時前`:b<7?`${b} 天前`:e.toLocaleDateString("zh-TW",{year:"numeric",month:"short",day:"numeric"})},c=async()=>{m.value=!0;try{const t=new URLSearchParams({page:o.value.page.toString(),limit:o.value.limit.toString()}),s=await E().get(`/notifications?${t}`);x.value=s.datas?.notifications||[],o.value.total=s.datas?.total||0,o.value.totalPages=Math.ceil(o.value.total/o.value.limit)}catch(t){console.error("Failed to fetch notifications:",t)}finally{m.value=!1}},R=()=>{o.value.page=1,c()},v=t=>{o.value.page=t,c()},T=async t=>{try{await E().post(`/notifications/${t}/read`,{});const s=x.value.find(d=>d.id===t);s&&(s.is_read=!0)}catch(e){console.error("Failed to mark as read:",e)}},V=async t=>{t.is_read||await T(t.id),t.type==="REVIEW_RESULT"||t.title==="例外單審核結果"?k.push("/teacher/exceptions"):t.type},y=$(()=>{let t=x.value;return i.value.readStatus==="unread"?t=t.filter(e=>!e.is_read):i.value.readStatus==="read"&&(t=t.filter(e=>e.is_read)),i.value.type&&(t=t.filter(e=>e.type===i.value.type)),t});return I(i,()=>{o.value.page=1,c()},{deep:!0}),D(()=>{c()}),(t,e)=>(n(),l("div",O,[e[7]||(e[7]=a("div",{class:"mb-6 md:mb-8"},[a("h1",{class:"text-2xl md:text-3xl font-bold text-slate-100 mb-2"}," 通知歷史 "),a("p",{class:"text-slate-400 text-sm md:text-base"}," 查看您的所有通知紀錄 ")],-1)),a("div",H,[h(a("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>r(i).readStatus=s),class:"px-4 py-2 bg-white/5 border border-white/10 rounded-xl text-slate-300 focus:outline-none focus:border-primary-500"},[...e[4]||(e[4]=[a("option",{value:""},"全部",-1),a("option",{value:"unread"},"未讀",-1),a("option",{value:"read"},"已讀",-1)])],512),[[_,r(i).readStatus]]),h(a("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>r(i).type=s),class:"px-4 py-2 bg-white/5 border border-white/10 rounded-xl text-slate-300 focus:outline-none focus:border-primary-500"},[...e[5]||(e[5]=[A('<option value="">全部類型</option><option value="APPROVAL">審核通過</option><option value="REVIEW_RESULT">審核結果</option><option value="EXCEPTION">例外申請</option><option value="SCHEDULE">課表通知</option><option value="CENTER_INVITE">中心邀請</option>',6)])],512),[[_,r(i).type]]),a("button",{onClick:R,class:"px-4 py-2 bg-primary-500/20 border border-primary-500 text-primary-400 rounded-xl hover:bg-primary-500/30 transition-colors"}," 重新整理 ")]),a("div",W,[r(m)?(n(),l("div",B,[...e[6]||(e[6]=[a("div",{class:"inline-block w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full animate-spin"},null,-1),a("p",{class:"text-slate-400 mt-2"},"載入中...",-1)])])):r(y).length===0?(n(),l("div",F," 暫無通知記錄 ")):(n(),l("div",X,[(n(!0),l(U,null,M(r(y),s=>(n(),l("div",{key:s.id,class:S(["p-4 hover:bg-white/5 transition-colors cursor-pointer",{"bg-primary-500/10":!s.is_read}]),onClick:d=>V(s)},[a("div",z,[a("div",q,[a("div",G,[a("h4",J,p(s.title),1),s.is_read?w("",!0):(n(),l("span",K))]),a("p",Q,p(s.message),1),a("div",Y,[a("p",Z,p(P(s.created_at)),1),a("span",{class:S(["px-2 py-0.5 rounded text-xs",{"bg-primary-500/20 text-primary-400":s.type==="APPROVAL","bg-success-500/20 text-success-400":s.type==="REVIEW_RESULT","bg-warning-500/20 text-warning-400":s.type==="EXCEPTION","bg-info-500/20 text-info-400":s.type==="SCHEDULE","bg-secondary-500/20 text-secondary-400":s.type==="CENTER_INVITE"}])},p(C(s.type)),3)])])])],10,j))),128))])),r(o).totalPages>1?(n(),l("div",ee,[a("p",te," 第 "+p(r(o).page)+" 頁，共 "+p(r(o).totalPages)+" 頁 ",1),a("div",se,[a("button",{onClick:e[2]||(e[2]=s=>v(r(o).page-1)),disabled:r(o).page===1,class:"px-3 py-1 rounded-lg bg-white/5 text-slate-300 hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed"}," 上一頁 ",8,ae),a("button",{onClick:e[3]||(e[3]=s=>v(r(o).page+1)),disabled:r(o).page===r(o).totalPages,class:"px-3 py-1 rounded-lg bg-white/5 text-slate-300 hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed"}," 下一頁 ",8,oe)])])):w("",!0)])]))}});export{le as default};
